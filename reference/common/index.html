
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../explanation/">
      
      
        <link rel="next" href="../datasets/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.20">
    
    
      
        <title>Common - camera-linearity-torch docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.e53b48f4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#common" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="camera-linearity-torch docs" class="md-header__button md-logo" aria-label="camera-linearity-torch docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            camera-linearity-torch docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Common
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="camera-linearity-torch docs" class="md-nav__button md-logo" aria-label="camera-linearity-torch docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    camera-linearity-torch docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Welcome to clair-torch
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Explanation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Common
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Common
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common" class="md-nav__link">
    <span class="md-ellipsis">
      common
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.BaseFileSettings" class="md-nav__link">
    <span class="md-ellipsis">
      BaseFileSettings
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BaseFileSettings">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.BaseFileSettings--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.BaseFileSettings.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.BaseFileSettings.get_all_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.BaseFileSettings.get_input_paths" class="md-nav__link">
    <span class="md-ellipsis">
      get_input_paths
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.BaseFileSettings.get_numeric_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      get_numeric_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.BaseFileSettings.get_output_paths" class="md-nav__link">
    <span class="md-ellipsis">
      get_output_paths
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.BaseFileSettings.get_text_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      get_text_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.BaseFileSettings.get_transforms" class="md-nav__link">
    <span class="md-ellipsis">
      get_transforms
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.BaseTransform" class="md-nav__link">
    <span class="md-ellipsis">
      BaseTransform
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BaseTransform">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.BaseTransform.from_config" class="md-nav__link">
    <span class="md-ellipsis">
      from_config
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.BaseTransform.to_config" class="md-nav__link">
    <span class="md-ellipsis">
      to_config
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.CastTo" class="md-nav__link">
    <span class="md-ellipsis">
      CastTo
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.ClampAlongDims" class="md-nav__link">
    <span class="md-ellipsis">
      ClampAlongDims
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.CvToTorch" class="md-nav__link">
    <span class="md-ellipsis">
      CvToTorch
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.FileSettings" class="md-nav__link">
    <span class="md-ellipsis">
      FileSettings
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FileSettings">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.FileSettings--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.FileSettings.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.FileSettings.get_all_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.FileSettings.get_candidate_std_output_path" class="md-nav__link">
    <span class="md-ellipsis">
      get_candidate_std_output_path
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.FileSettings.get_input_paths" class="md-nav__link">
    <span class="md-ellipsis">
      get_input_paths
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.FileSettings.get_numeric_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      get_numeric_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.FileSettings.get_output_paths" class="md-nav__link">
    <span class="md-ellipsis">
      get_output_paths
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.FileSettings.get_text_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      get_text_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.FileSettings.get_transforms" class="md-nav__link">
    <span class="md-ellipsis">
      get_transforms
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.FrameSettings" class="md-nav__link">
    <span class="md-ellipsis">
      FrameSettings
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FrameSettings">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.FrameSettings--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.FrameSettings.get_all_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.FrameSettings.get_numeric_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      get_numeric_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.FrameSettings.get_text_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      get_text_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.FrameSettings.is_match" class="md-nav__link">
    <span class="md-ellipsis">
      is_match
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.InterpMode" class="md-nav__link">
    <span class="md-ellipsis">
      InterpMode
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.MissingStdMode" class="md-nav__link">
    <span class="md-ellipsis">
      MissingStdMode
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.Normalize" class="md-nav__link">
    <span class="md-ellipsis">
      Normalize
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.PairedFileSettings" class="md-nav__link">
    <span class="md-ellipsis">
      PairedFileSettings
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PairedFileSettings">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.PairedFileSettings--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.PairedFileSettings.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.PairedFileSettings.get_input_paths" class="md-nav__link">
    <span class="md-ellipsis">
      get_input_paths
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.PairedFileSettings.get_output_paths" class="md-nav__link">
    <span class="md-ellipsis">
      get_output_paths
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.PairedFileSettings.get_transforms" class="md-nav__link">
    <span class="md-ellipsis">
      get_transforms
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.PairedFrameSettings" class="md-nav__link">
    <span class="md-ellipsis">
      PairedFrameSettings
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PairedFrameSettings">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.PairedFrameSettings--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.PairedFrameSettings.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.PairedFrameSettings.get_all_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.PairedFrameSettings.get_numeric_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      get_numeric_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.PairedFrameSettings.get_text_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      get_text_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.PairedFrameSettings.is_match" class="md-nav__link">
    <span class="md-ellipsis">
      is_match
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.StridedDownscale" class="md-nav__link">
    <span class="md-ellipsis">
      StridedDownscale
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.TorchToCv" class="md-nav__link">
    <span class="md-ellipsis">
      TorchToCv
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.VarianceMode" class="md-nav__link">
    <span class="md-ellipsis">
      VarianceMode
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.WBOMean" class="md-nav__link">
    <span class="md-ellipsis">
      WBOMean
    </span>
  </a>
  
    <nav class="md-nav" aria-label="WBOMean">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.WBOMean.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.WBOMean.internal_detach" class="md-nav__link">
    <span class="md-ellipsis">
      internal_detach
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.WBOMean.update_values" class="md-nav__link">
    <span class="md-ellipsis">
      update_values
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.WBOMeanVar" class="md-nav__link">
    <span class="md-ellipsis">
      WBOMeanVar
    </span>
  </a>
  
    <nav class="md-nav" aria-label="WBOMeanVar">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.WBOMeanVar.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.WBOMeanVar.internal_detach" class="md-nav__link">
    <span class="md-ellipsis">
      internal_detach
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.WBOMeanVar.update_values" class="md-nav__link">
    <span class="md-ellipsis">
      update_values
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.clamp_along_dims" class="md-nav__link">
    <span class="md-ellipsis">
      clamp_along_dims
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.cli_parse_args_from_config" class="md-nav__link">
    <span class="md-ellipsis">
      cli_parse_args_from_config
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.conditional_gaussian_blur" class="md-nav__link">
    <span class="md-ellipsis">
      conditional_gaussian_blur
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.cv_to_torch" class="md-nav__link">
    <span class="md-ellipsis">
      cv_to_torch
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.file_settings_constructor" class="md-nav__link">
    <span class="md-ellipsis">
      file_settings_constructor
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.flat_field_mean" class="md-nav__link">
    <span class="md-ellipsis">
      flat_field_mean
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.flatfield_correction" class="md-nav__link">
    <span class="md-ellipsis">
      flatfield_correction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.get_pairwise_valid_pixel_mask" class="md-nav__link">
    <span class="md-ellipsis">
      get_pairwise_valid_pixel_mask
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.get_valid_exposure_pairs" class="md-nav__link">
    <span class="md-ellipsis">
      get_valid_exposure_pairs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.group_frame_settings_by_attributes" class="md-nav__link">
    <span class="md-ellipsis">
      group_frame_settings_by_attributes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.load_icrf_txt" class="md-nav__link">
    <span class="md-ellipsis">
      load_icrf_txt
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.load_image" class="md-nav__link">
    <span class="md-ellipsis">
      load_image
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.load_principal_components" class="md-nav__link">
    <span class="md-ellipsis">
      load_principal_components
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.load_video_frames_generator" class="md-nav__link">
    <span class="md-ellipsis">
      load_video_frames_generator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.normalize_tensor" class="md-nav__link">
    <span class="md-ellipsis">
      normalize_tensor
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.save_icrf_txt" class="md-nav__link">
    <span class="md-ellipsis">
      save_icrf_txt
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.save_image" class="md-nav__link">
    <span class="md-ellipsis">
      save_image
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.weighted_mean_and_std" class="md-nav__link">
    <span class="md-ellipsis">
      weighted_mean_and_std
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../datasets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Datasets
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../inference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Inference
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../metadata/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Metadata
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Models
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../summary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Summary
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../training/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Training
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../validation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Validation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../visualization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Visualization
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common" class="md-nav__link">
    <span class="md-ellipsis">
      common
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.BaseFileSettings" class="md-nav__link">
    <span class="md-ellipsis">
      BaseFileSettings
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BaseFileSettings">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.BaseFileSettings--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.BaseFileSettings.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.BaseFileSettings.get_all_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.BaseFileSettings.get_input_paths" class="md-nav__link">
    <span class="md-ellipsis">
      get_input_paths
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.BaseFileSettings.get_numeric_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      get_numeric_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.BaseFileSettings.get_output_paths" class="md-nav__link">
    <span class="md-ellipsis">
      get_output_paths
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.BaseFileSettings.get_text_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      get_text_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.BaseFileSettings.get_transforms" class="md-nav__link">
    <span class="md-ellipsis">
      get_transforms
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.BaseTransform" class="md-nav__link">
    <span class="md-ellipsis">
      BaseTransform
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BaseTransform">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.BaseTransform.from_config" class="md-nav__link">
    <span class="md-ellipsis">
      from_config
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.BaseTransform.to_config" class="md-nav__link">
    <span class="md-ellipsis">
      to_config
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.CastTo" class="md-nav__link">
    <span class="md-ellipsis">
      CastTo
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.ClampAlongDims" class="md-nav__link">
    <span class="md-ellipsis">
      ClampAlongDims
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.CvToTorch" class="md-nav__link">
    <span class="md-ellipsis">
      CvToTorch
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.FileSettings" class="md-nav__link">
    <span class="md-ellipsis">
      FileSettings
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FileSettings">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.FileSettings--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.FileSettings.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.FileSettings.get_all_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.FileSettings.get_candidate_std_output_path" class="md-nav__link">
    <span class="md-ellipsis">
      get_candidate_std_output_path
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.FileSettings.get_input_paths" class="md-nav__link">
    <span class="md-ellipsis">
      get_input_paths
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.FileSettings.get_numeric_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      get_numeric_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.FileSettings.get_output_paths" class="md-nav__link">
    <span class="md-ellipsis">
      get_output_paths
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.FileSettings.get_text_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      get_text_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.FileSettings.get_transforms" class="md-nav__link">
    <span class="md-ellipsis">
      get_transforms
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.FrameSettings" class="md-nav__link">
    <span class="md-ellipsis">
      FrameSettings
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FrameSettings">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.FrameSettings--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.FrameSettings.get_all_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.FrameSettings.get_numeric_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      get_numeric_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.FrameSettings.get_text_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      get_text_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.FrameSettings.is_match" class="md-nav__link">
    <span class="md-ellipsis">
      is_match
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.InterpMode" class="md-nav__link">
    <span class="md-ellipsis">
      InterpMode
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.MissingStdMode" class="md-nav__link">
    <span class="md-ellipsis">
      MissingStdMode
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.Normalize" class="md-nav__link">
    <span class="md-ellipsis">
      Normalize
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.PairedFileSettings" class="md-nav__link">
    <span class="md-ellipsis">
      PairedFileSettings
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PairedFileSettings">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.PairedFileSettings--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.PairedFileSettings.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.PairedFileSettings.get_input_paths" class="md-nav__link">
    <span class="md-ellipsis">
      get_input_paths
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.PairedFileSettings.get_output_paths" class="md-nav__link">
    <span class="md-ellipsis">
      get_output_paths
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.PairedFileSettings.get_transforms" class="md-nav__link">
    <span class="md-ellipsis">
      get_transforms
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.PairedFrameSettings" class="md-nav__link">
    <span class="md-ellipsis">
      PairedFrameSettings
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PairedFrameSettings">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.PairedFrameSettings--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.PairedFrameSettings.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.PairedFrameSettings.get_all_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.PairedFrameSettings.get_numeric_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      get_numeric_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.PairedFrameSettings.get_text_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      get_text_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.PairedFrameSettings.is_match" class="md-nav__link">
    <span class="md-ellipsis">
      is_match
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.StridedDownscale" class="md-nav__link">
    <span class="md-ellipsis">
      StridedDownscale
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.TorchToCv" class="md-nav__link">
    <span class="md-ellipsis">
      TorchToCv
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.VarianceMode" class="md-nav__link">
    <span class="md-ellipsis">
      VarianceMode
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.WBOMean" class="md-nav__link">
    <span class="md-ellipsis">
      WBOMean
    </span>
  </a>
  
    <nav class="md-nav" aria-label="WBOMean">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.WBOMean.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.WBOMean.internal_detach" class="md-nav__link">
    <span class="md-ellipsis">
      internal_detach
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.WBOMean.update_values" class="md-nav__link">
    <span class="md-ellipsis">
      update_values
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.WBOMeanVar" class="md-nav__link">
    <span class="md-ellipsis">
      WBOMeanVar
    </span>
  </a>
  
    <nav class="md-nav" aria-label="WBOMeanVar">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.WBOMeanVar.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.WBOMeanVar.internal_detach" class="md-nav__link">
    <span class="md-ellipsis">
      internal_detach
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.common.WBOMeanVar.update_values" class="md-nav__link">
    <span class="md-ellipsis">
      update_values
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.clamp_along_dims" class="md-nav__link">
    <span class="md-ellipsis">
      clamp_along_dims
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.cli_parse_args_from_config" class="md-nav__link">
    <span class="md-ellipsis">
      cli_parse_args_from_config
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.conditional_gaussian_blur" class="md-nav__link">
    <span class="md-ellipsis">
      conditional_gaussian_blur
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.cv_to_torch" class="md-nav__link">
    <span class="md-ellipsis">
      cv_to_torch
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.file_settings_constructor" class="md-nav__link">
    <span class="md-ellipsis">
      file_settings_constructor
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.flat_field_mean" class="md-nav__link">
    <span class="md-ellipsis">
      flat_field_mean
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.flatfield_correction" class="md-nav__link">
    <span class="md-ellipsis">
      flatfield_correction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.get_pairwise_valid_pixel_mask" class="md-nav__link">
    <span class="md-ellipsis">
      get_pairwise_valid_pixel_mask
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.get_valid_exposure_pairs" class="md-nav__link">
    <span class="md-ellipsis">
      get_valid_exposure_pairs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.group_frame_settings_by_attributes" class="md-nav__link">
    <span class="md-ellipsis">
      group_frame_settings_by_attributes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.load_icrf_txt" class="md-nav__link">
    <span class="md-ellipsis">
      load_icrf_txt
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.load_image" class="md-nav__link">
    <span class="md-ellipsis">
      load_image
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.load_principal_components" class="md-nav__link">
    <span class="md-ellipsis">
      load_principal_components
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.load_video_frames_generator" class="md-nav__link">
    <span class="md-ellipsis">
      load_video_frames_generator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.normalize_tensor" class="md-nav__link">
    <span class="md-ellipsis">
      normalize_tensor
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.save_icrf_txt" class="md-nav__link">
    <span class="md-ellipsis">
      save_icrf_txt
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.save_image" class="md-nav__link">
    <span class="md-ellipsis">
      save_image
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.common.weighted_mean_and_std" class="md-nav__link">
    <span class="md-ellipsis">
      weighted_mean_and_std
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="common">Common</h1>
<p>This page acts as the technical reference for the common subpackage.</p>


<div class="doc doc-object doc-module">



<a id="clair_torch.common"></a>
    <div class="doc doc-contents first">

        <p>The common package provides typical utilities used with all the other packages in this project, including
    - Classes and functions for IO operations.
    - Enums used with various classes.
    - General mathematical functions and transformation operations in both function and Class forms.</p>










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="clair_torch.common.BaseFileSettings" class="doc doc-heading">
            <code>BaseFileSettings</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="abc.ABC">ABC</span></code></p>


        <p>Base class for implementing classes that manage IO operations.</p>
<p>BaseFileSettings acts as the guideline for designing classes for camera_linearity_torch's IO operations.</p>
<h4 id="clair_torch.common.BaseFileSettings--attributes">Attributes</h4>
<p>input_path: Path
    a filepath from which the data will be read.
output_path: Path
    a filepath to which data can be saved. Based on the optional output_path init argument. If None is given, then
    the parent directory of input_path is used as a root in which a new directory called based on default_output_root
    is created, in which the same filename as the input_path's name will be used to create a new file upon saving.
default_output_root: Path
    a default dirpath to utilize as the directory in which the output file is created upon saving. Based on the
    default_output_root init argument. If None is given, then defaults to a new dirpath called
    'clair_torch_output' in the directory of the input file.
cpu_transforms: Transform | Sequence[Transform] | None
    Optional collection of Transforms that will be performed on the data right after reading it from a file.</p>








              <details class="quote">
                <summary>Source code in <code>clair_torch/common/base.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">BaseFileSettings</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for implementing classes that manage IO operations.</span>

<span class="sd">    BaseFileSettings acts as the guideline for designing classes for camera_linearity_torch&#39;s IO operations.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    input_path: Path</span>
<span class="sd">        a filepath from which the data will be read.</span>
<span class="sd">    output_path: Path</span>
<span class="sd">        a filepath to which data can be saved. Based on the optional output_path init argument. If None is given, then</span>
<span class="sd">        the parent directory of input_path is used as a root in which a new directory called based on default_output_root</span>
<span class="sd">        is created, in which the same filename as the input_path&#39;s name will be used to create a new file upon saving.</span>
<span class="sd">    default_output_root: Path</span>
<span class="sd">        a default dirpath to utilize as the directory in which the output file is created upon saving. Based on the</span>
<span class="sd">        default_output_root init argument. If None is given, then defaults to a new dirpath called</span>
<span class="sd">        &#39;clair_torch_output&#39; in the directory of the input file.</span>
<span class="sd">    cpu_transforms: Transform | Sequence[Transform] | None</span>
<span class="sd">        Optional collection of Transforms that will be performed on the data right after reading it from a file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@typechecked</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span> <span class="n">output_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">default_output_root</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">cpu_transforms</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BaseTransform</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">BaseTransform</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the instance with the given paths. Output and default roots are optional and defer to a default</span>
<span class="sd">        output root if None is given. output_path overrides any possible default_output_root values. Upon loading data</span>
<span class="sd">        the given cpu_transforms are performed on the data sequentially.</span>
<span class="sd">        Args:</span>
<span class="sd">            input_path: the path at which the file is found.</span>
<span class="sd">            output_path: the path to which output a modified file.</span>
<span class="sd">            default_output_root: a root directory path to utilize if no output_path is given.</span>
<span class="sd">            cpu_transforms: Transform(s) to be performed on the data on the cpu-side upon loading the data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">input_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_path</span><span class="p">)</span>
        <span class="n">output_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_path</span><span class="p">)</span> <span class="k">if</span> <span class="n">output_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">default_output_root</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">default_output_root</span><span class="p">)</span> <span class="k">if</span> <span class="n">default_output_root</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="n">validate_input_file_path</span><span class="p">(</span><span class="n">input_path</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_path</span> <span class="o">=</span> <span class="n">input_path</span>
        <span class="k">if</span> <span class="n">default_output_root</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">default_output_root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;clair_torch_output&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">default_output_root</span> <span class="o">=</span> <span class="n">default_output_root</span>

        <span class="k">if</span> <span class="n">output_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_path</span> <span class="o">=</span> <span class="n">output_path</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_output_root</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_path</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_potentially_valid_file_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid path for your OS: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cpu_transforms</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cpu_transforms</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">cpu_transforms</span> <span class="o">=</span> <span class="p">[</span><span class="n">cpu_transforms</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">cpu_transforms</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">BaseTransform</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">cpu_transforms</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;At least one item in transforms is of incorrect type: </span><span class="si">{</span><span class="n">cpu_transforms</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cpu_transforms</span> <span class="o">=</span> <span class="n">cpu_transforms</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_input_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method for getting the input path(s) from a FileSettings class.</span>
<span class="sd">        Returns:</span>
<span class="sd">            A single Path or tuple of Paths.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_output_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method for getting the output path(s) from a FileSettings class.</span>
<span class="sd">        Returns:</span>
<span class="sd">            A single Path or tuple of Paths.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_transforms</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">BaseTransform</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method for getting the possible Transform operations from a FileSettings class.</span>
<span class="sd">        Returns:</span>
<span class="sd">            A list of Transforms or None if no Transforms are given.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_numeric_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method for getting numeric metadata associated with a file. Should always return at least an empty dict.</span>
<span class="sd">        Returns:</span>
<span class="sd">            dict[str, int | float]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_text_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method for getting the text metadata associated with a file. Should always return at least an empty dict.</span>
<span class="sd">        Returns:</span>
<span class="sd">            dict[str, str]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_all_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method for getting all the metadata associated with a file. Should always return at least an empty dict.</span>
<span class="sd">        Returns:</span>
<span class="sd">            dict[str, int | float | str]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="clair_torch.common.BaseFileSettings.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">input_path</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">default_output_root</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cpu_transforms</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initializes the instance with the given paths. Output and default roots are optional and defer to a default
output root if None is given. output_path overrides any possible default_output_root values. Upon loading data
the given cpu_transforms are performed on the data sequentially.
Args:
    input_path: the path at which the file is found.
    output_path: the path to which output a modified file.
    default_output_root: a root directory path to utilize if no output_path is given.
    cpu_transforms: Transform(s) to be performed on the data on the cpu-side upon loading the data.</p>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@typechecked</span>
<span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span> <span class="n">output_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">default_output_root</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">cpu_transforms</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BaseTransform</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">BaseTransform</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initializes the instance with the given paths. Output and default roots are optional and defer to a default</span>
<span class="sd">    output root if None is given. output_path overrides any possible default_output_root values. Upon loading data</span>
<span class="sd">    the given cpu_transforms are performed on the data sequentially.</span>
<span class="sd">    Args:</span>
<span class="sd">        input_path: the path at which the file is found.</span>
<span class="sd">        output_path: the path to which output a modified file.</span>
<span class="sd">        default_output_root: a root directory path to utilize if no output_path is given.</span>
<span class="sd">        cpu_transforms: Transform(s) to be performed on the data on the cpu-side upon loading the data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">input_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_path</span><span class="p">)</span>
    <span class="n">output_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_path</span><span class="p">)</span> <span class="k">if</span> <span class="n">output_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">default_output_root</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">default_output_root</span><span class="p">)</span> <span class="k">if</span> <span class="n">default_output_root</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="n">validate_input_file_path</span><span class="p">(</span><span class="n">input_path</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">input_path</span> <span class="o">=</span> <span class="n">input_path</span>
    <span class="k">if</span> <span class="n">default_output_root</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_output_root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;clair_torch_output&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_output_root</span> <span class="o">=</span> <span class="n">default_output_root</span>

    <span class="k">if</span> <span class="n">output_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_path</span> <span class="o">=</span> <span class="n">output_path</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_output_root</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_path</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_potentially_valid_file_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_path</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid path for your OS: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">cpu_transforms</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cpu_transforms</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="n">cpu_transforms</span> <span class="o">=</span> <span class="p">[</span><span class="n">cpu_transforms</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">cpu_transforms</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">BaseTransform</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">cpu_transforms</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;At least one item in transforms is of incorrect type: </span><span class="si">{</span><span class="n">cpu_transforms</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">cpu_transforms</span> <span class="o">=</span> <span class="n">cpu_transforms</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="clair_torch.common.BaseFileSettings.get_all_metadata" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_all_metadata</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Method for getting all the metadata associated with a file. Should always return at least an empty dict.
Returns:
    dict[str, int | float | str]</p>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_all_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method for getting all the metadata associated with a file. Should always return at least an empty dict.</span>
<span class="sd">    Returns:</span>
<span class="sd">        dict[str, int | float | str]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="clair_torch.common.BaseFileSettings.get_input_paths" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_input_paths</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Method for getting the input path(s) from a FileSettings class.
Returns:
    A single Path or tuple of Paths.</p>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_input_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method for getting the input path(s) from a FileSettings class.</span>
<span class="sd">    Returns:</span>
<span class="sd">        A single Path or tuple of Paths.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="clair_torch.common.BaseFileSettings.get_numeric_metadata" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_numeric_metadata</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Method for getting numeric metadata associated with a file. Should always return at least an empty dict.
Returns:
    dict[str, int | float]</p>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_numeric_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method for getting numeric metadata associated with a file. Should always return at least an empty dict.</span>
<span class="sd">    Returns:</span>
<span class="sd">        dict[str, int | float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="clair_torch.common.BaseFileSettings.get_output_paths" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_output_paths</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Method for getting the output path(s) from a FileSettings class.
Returns:
    A single Path or tuple of Paths.</p>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_output_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method for getting the output path(s) from a FileSettings class.</span>
<span class="sd">    Returns:</span>
<span class="sd">        A single Path or tuple of Paths.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="clair_torch.common.BaseFileSettings.get_text_metadata" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_text_metadata</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Method for getting the text metadata associated with a file. Should always return at least an empty dict.
Returns:
    dict[str, str]</p>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_text_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method for getting the text metadata associated with a file. Should always return at least an empty dict.</span>
<span class="sd">    Returns:</span>
<span class="sd">        dict[str, str]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="clair_torch.common.BaseFileSettings.get_transforms" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_transforms</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Method for getting the possible Transform operations from a FileSettings class.
Returns:
    A list of Transforms or None if no Transforms are given.</p>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_transforms</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">BaseTransform</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method for getting the possible Transform operations from a FileSettings class.</span>
<span class="sd">    Returns:</span>
<span class="sd">        A list of Transforms or None if no Transforms are given.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="clair_torch.common.BaseTransform" class="doc doc-heading">
            <code>BaseTransform</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="abc.ABC">ABC</span></code></p>


        <p>Base class for Transform classes, which typically wrap a function from general functions. Must be callable, taking
a torch.Tensor as input and return a torch.Tensor.</p>








              <details class="quote">
                <summary>Source code in <code>clair_torch/common/transforms.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">BaseTransform</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for Transform classes, which typically wrap a function from general functions. Must be callable, taking</span>
<span class="sd">    a torch.Tensor as input and return a torch.Tensor.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="o">...</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
        <span class="o">...</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_config</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Serialization function, which dumps the instance into a dictionary representation.</span>
<span class="sd">        Returns: dictionary that can be used to deserialize back into an equivalent instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="o">...</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">cfg</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deserialization function, which initializes a new instance from a dictionary representation</span>
<span class="sd">        of the class.</span>
<span class="sd">        Args:</span>
<span class="sd">            cfg: the configuration dictionary.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A new instance of this class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">cfg</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="clair_torch.common.BaseTransform.from_config" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_config</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Deserialization function, which initializes a new instance from a dictionary representation
of the class.
Args:
    cfg: the configuration dictionary.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A new instance of this class.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/transforms.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">cfg</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Deserialization function, which initializes a new instance from a dictionary representation</span>
<span class="sd">    of the class.</span>
<span class="sd">    Args:</span>
<span class="sd">        cfg: the configuration dictionary.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A new instance of this class.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">cfg</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="clair_torch.common.BaseTransform.to_config" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_config</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Serialization function, which dumps the instance into a dictionary representation.
Returns: dictionary that can be used to deserialize back into an equivalent instance.</p>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/transforms.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">to_config</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Serialization function, which dumps the instance into a dictionary representation.</span>
<span class="sd">    Returns: dictionary that can be used to deserialize back into an equivalent instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="clair_torch.common.CastTo" class="doc doc-heading">
            <code>CastTo</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="BaseTransform (clair_torch.common.transforms.BaseTransform)" href="#clair_torch.common.BaseTransform">BaseTransform</a></code></p>


        <p>Transform for casting the tensor to the given datatype and device. If data_type or device are not give, then
maintain them as they are.</p>








              <details class="quote">
                <summary>Source code in <code>clair_torch/common/transforms.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@_register_transform</span>
<span class="k">class</span><span class="w"> </span><span class="nc">CastTo</span><span class="p">(</span><span class="n">BaseTransform</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transform for casting the tensor to the given datatype and device. If data_type or device are not give, then</span>
<span class="sd">    maintain them as they are.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@typechecked</span><span class="p">()</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">torch</span><span class="o">.</span><span class="n">dtype</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">device</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_type</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">data_type</span> <span class="o">=</span> <span class="n">DTYPE_MAP</span><span class="p">[</span><span class="n">data_type</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data_type</span> <span class="o">=</span> <span class="n">data_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>

    <span class="nd">@typechecked</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>

        <span class="n">data_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_type</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">x</span><span class="o">.</span><span class="n">dtype</span>
        <span class="n">device</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">x</span><span class="o">.</span><span class="n">device</span>

        <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">data_type</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_config</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="n">REVERSE_DTYPE_MAP</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_type</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;data_type&quot;</span><span class="p">:</span> <span class="n">dtype</span><span class="p">,</span>
            <span class="s2">&quot;device&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="p">}</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="clair_torch.common.ClampAlongDims" class="doc doc-heading">
            <code>ClampAlongDims</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="BaseTransform (clair_torch.common.transforms.BaseTransform)" href="#clair_torch.common.BaseTransform">BaseTransform</a></code></p>


        <p>Transform for clamping the tensor values between a min and max value, along the given dimension(s).</p>








              <details class="quote">
                <summary>Source code in <code>clair_torch/common/transforms.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@_register_transform</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ClampAlongDims</span><span class="p">(</span><span class="n">BaseTransform</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transform for clamping the tensor values between a min and max value, along the given dimension(s).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@typechecked</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">min_max_pairs</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]):</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_max_pairs</span> <span class="o">=</span> <span class="n">min_max_pairs</span>

    <span class="nd">@typechecked</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>

        <span class="k">return</span> <span class="n">clamp_along_dims</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_max_pairs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_config</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;dim&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span>
            <span class="s2">&quot;min_max_pairs&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_max_pairs</span><span class="p">,</span>
        <span class="p">}</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="clair_torch.common.CvToTorch" class="doc doc-heading">
            <code>CvToTorch</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="BaseTransform (clair_torch.common.transforms.BaseTransform)" href="#clair_torch.common.BaseTransform">BaseTransform</a></code></p>


        <p>Transform for modifying a tensor from OpenCV dimensions and channel ordering to a PyTorch dimensionality and
ordering.</p>








              <details class="quote">
                <summary>Source code in <code>clair_torch/common/transforms.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@_register_transform</span>
<span class="k">class</span><span class="w"> </span><span class="nc">CvToTorch</span><span class="p">(</span><span class="n">BaseTransform</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transform for modifying a tensor from OpenCV dimensions and channel ordering to a PyTorch dimensionality and</span>
<span class="sd">    ordering.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="k">pass</span>

    <span class="nd">@typechecked</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>

        <span class="k">return</span> <span class="n">cv_to_torch</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_config</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="clair_torch.common.FileSettings" class="doc doc-heading">
            <code>FileSettings</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="BaseFileSettings (clair_torch.common.base.BaseFileSettings)" href="#clair_torch.common.BaseFileSettings">BaseFileSettings</a></code></p>


        <p>Class for managing input and output paths related to an arbitrary file. Main use is to manage the IO settings for
use inside a PyTorch Dataset class.</p>
<h4 id="clair_torch.common.FileSettings--attributes">Attributes:</h4>
<p>Inherits attributes from BaseFileSettings.</p>








              <details class="quote">
                <summary>Source code in <code>clair_torch/common/file_settings.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">FileSettings</span><span class="p">(</span><span class="n">BaseFileSettings</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for managing input and output paths related to an arbitrary file. Main use is to manage the IO settings for</span>
<span class="sd">    use inside a PyTorch Dataset class.</span>

<span class="sd">    Attributes:</span>
<span class="sd">    -----------</span>
<span class="sd">    Inherits attributes from BaseFileSettings.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@typechecked</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span> <span class="n">output_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">default_output_root</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">cpu_transforms</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BaseTransform</span> <span class="o">|</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">BaseTransform</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the instance with the given paths. Output and default roots are optional and defer to a default</span>
<span class="sd">        output root if None is given. output_path overrides any possible default_output_root values. Upon loading data</span>
<span class="sd">        the given cpu_transforms are performed on the data sequentially.</span>
<span class="sd">        Args:</span>
<span class="sd">            input_path: the path at which the file is found.</span>
<span class="sd">            output_path: the path to which output a modified file.</span>
<span class="sd">            default_output_root: a root directory path to utilize if no output_path is given.</span>
<span class="sd">            cpu_transforms: Transform(s) to be performed on the data on the cpu-side upon loading the data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">input_path</span><span class="p">,</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">default_output_root</span><span class="p">,</span> <span class="n">cpu_transforms</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_input_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method for getting the input path.</span>
<span class="sd">        Returns:</span>
<span class="sd">            Path.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_path</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_output_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method for getting the output path.</span>
<span class="sd">        Returns:</span>
<span class="sd">            Path.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_path</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_candidate_std_output_path</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method for getting a candidate output path for an uncertainty file.</span>
<span class="sd">        Returns:</span>
<span class="sd">            Constructed uncertainty file output path based on the main input file and its filetype suffix.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">candidate_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_path</span><span class="o">.</span><span class="n">stem</span> <span class="o">+</span> <span class="s2">&quot; STD&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_path</span><span class="o">.</span><span class="n">suffix</span>
        <span class="n">std_output_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_path</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="n">candidate_name</span>

        <span class="k">return</span> <span class="n">std_output_path</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_transforms</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">BaseTransform</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method for getting the possible Transform operations to be performed on the data upon reading it.</span>
<span class="sd">        Returns:</span>
<span class="sd">            List[Transform] or None, if no Transform operations were given on init.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpu_transforms</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_numeric_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Unused method stub inherited from the base class. This is used in classes further down the subclass tree.</span>
<span class="sd">        Returns:</span>
<span class="sd">            Empty dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_text_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Unused method stub inherited from the base class. This is used in classes further down the subclass tree.</span>
<span class="sd">        Returns:</span>
<span class="sd">            Empty dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_all_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Unused method stub inherited from the base class. This is used in classes further down the subclass tree.</span>
<span class="sd">        Returns:</span>
<span class="sd">            Empty dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="clair_torch.common.FileSettings.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">input_path</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">default_output_root</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cpu_transforms</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initializes the instance with the given paths. Output and default roots are optional and defer to a default
output root if None is given. output_path overrides any possible default_output_root values. Upon loading data
the given cpu_transforms are performed on the data sequentially.
Args:
    input_path: the path at which the file is found.
    output_path: the path to which output a modified file.
    default_output_root: a root directory path to utilize if no output_path is given.
    cpu_transforms: Transform(s) to be performed on the data on the cpu-side upon loading the data.</p>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/file_settings.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@typechecked</span>
<span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span> <span class="n">output_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">default_output_root</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">cpu_transforms</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BaseTransform</span> <span class="o">|</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">BaseTransform</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initializes the instance with the given paths. Output and default roots are optional and defer to a default</span>
<span class="sd">    output root if None is given. output_path overrides any possible default_output_root values. Upon loading data</span>
<span class="sd">    the given cpu_transforms are performed on the data sequentially.</span>
<span class="sd">    Args:</span>
<span class="sd">        input_path: the path at which the file is found.</span>
<span class="sd">        output_path: the path to which output a modified file.</span>
<span class="sd">        default_output_root: a root directory path to utilize if no output_path is given.</span>
<span class="sd">        cpu_transforms: Transform(s) to be performed on the data on the cpu-side upon loading the data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">input_path</span><span class="p">,</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">default_output_root</span><span class="p">,</span> <span class="n">cpu_transforms</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="clair_torch.common.FileSettings.get_all_metadata" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_all_metadata</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Unused method stub inherited from the base class. This is used in classes further down the subclass tree.
Returns:
    Empty dict.</p>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/file_settings.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_all_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Unused method stub inherited from the base class. This is used in classes further down the subclass tree.</span>
<span class="sd">    Returns:</span>
<span class="sd">        Empty dict.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="clair_torch.common.FileSettings.get_candidate_std_output_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_candidate_std_output_path</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Method for getting a candidate output path for an uncertainty file.
Returns:
    Constructed uncertainty file output path based on the main input file and its filetype suffix.</p>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/file_settings.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_candidate_std_output_path</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method for getting a candidate output path for an uncertainty file.</span>
<span class="sd">    Returns:</span>
<span class="sd">        Constructed uncertainty file output path based on the main input file and its filetype suffix.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">candidate_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_path</span><span class="o">.</span><span class="n">stem</span> <span class="o">+</span> <span class="s2">&quot; STD&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_path</span><span class="o">.</span><span class="n">suffix</span>
    <span class="n">std_output_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_path</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="n">candidate_name</span>

    <span class="k">return</span> <span class="n">std_output_path</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="clair_torch.common.FileSettings.get_input_paths" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_input_paths</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Method for getting the input path.
Returns:
    Path.</p>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/file_settings.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_input_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method for getting the input path.</span>
<span class="sd">    Returns:</span>
<span class="sd">        Path.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_path</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="clair_torch.common.FileSettings.get_numeric_metadata" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_numeric_metadata</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Unused method stub inherited from the base class. This is used in classes further down the subclass tree.
Returns:
    Empty dict.</p>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/file_settings.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_numeric_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Unused method stub inherited from the base class. This is used in classes further down the subclass tree.</span>
<span class="sd">    Returns:</span>
<span class="sd">        Empty dict.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="clair_torch.common.FileSettings.get_output_paths" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_output_paths</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Method for getting the output path.
Returns:
    Path.</p>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/file_settings.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_output_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method for getting the output path.</span>
<span class="sd">    Returns:</span>
<span class="sd">        Path.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_path</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="clair_torch.common.FileSettings.get_text_metadata" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_text_metadata</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Unused method stub inherited from the base class. This is used in classes further down the subclass tree.
Returns:
    Empty dict.</p>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/file_settings.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_text_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Unused method stub inherited from the base class. This is used in classes further down the subclass tree.</span>
<span class="sd">    Returns:</span>
<span class="sd">        Empty dict.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="clair_torch.common.FileSettings.get_transforms" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_transforms</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Method for getting the possible Transform operations to be performed on the data upon reading it.
Returns:
    List[Transform] or None, if no Transform operations were given on init.</p>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/file_settings.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_transforms</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">BaseTransform</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method for getting the possible Transform operations to be performed on the data upon reading it.</span>
<span class="sd">    Returns:</span>
<span class="sd">        List[Transform] or None, if no Transform operations were given on init.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpu_transforms</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="clair_torch.common.FrameSettings" class="doc doc-heading">
            <code>FrameSettings</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="FileSettings (clair_torch.common.file_settings.FileSettings)" href="#clair_torch.common.FileSettings">FileSettings</a></code></p>


        <p>Class for managing input and output paths related to an arbitrary file, with the addition of managing image related
metadata. Main use is to manage the IO settings for use inside a PyTorch Dataset class.</p>
<h4 id="clair_torch.common.FrameSettings--attributes">Attributes:</h4>
<p>Inherits attributes from FileSettings.
metadata: BaseMetadata
    an encapsulated instance of a BaseMetadata subclass for managing the metadata related to images.</p>








              <details class="quote">
                <summary>Source code in <code>clair_torch/common/file_settings.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">FrameSettings</span><span class="p">(</span><span class="n">FileSettings</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for managing input and output paths related to an arbitrary file, with the addition of managing image related</span>
<span class="sd">    metadata. Main use is to manage the IO settings for use inside a PyTorch Dataset class.</span>

<span class="sd">    Attributes:</span>
<span class="sd">    -----------</span>
<span class="sd">    Inherits attributes from FileSettings.</span>
<span class="sd">    metadata: BaseMetadata</span>
<span class="sd">        an encapsulated instance of a BaseMetadata subclass for managing the metadata related to images.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@typechecked</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span> <span class="n">output_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">default_output_root</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">cpu_transforms</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BaseTransform</span> <span class="o">|</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">BaseTransform</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">metadata_cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">BaseMetadata</span><span class="p">]</span> <span class="o">=</span> <span class="n">ImagingMetadata</span><span class="p">,</span>
                 <span class="o">*</span><span class="n">metadata_args</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata_kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">input_path</span><span class="p">,</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">default_output_root</span><span class="p">,</span> <span class="n">cpu_transforms</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">metadata_cls</span><span class="p">(</span><span class="n">input_path</span><span class="p">,</span> <span class="o">*</span><span class="n">metadata_args</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata_kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_numeric_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method for getting the numeric metadata managed by the encapsulated Metadata class.</span>
<span class="sd">        Returns:</span>
<span class="sd">            dict[str, int | float].</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get_numeric_metadata</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_text_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method for getting the text metadata managed by the encapsulated Metadata class.</span>
<span class="sd">        Returns:</span>
<span class="sd">            dict[str, str].</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get_text_metadata</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_all_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method for getting all the metadata managed by the encapsulated Metadata class.</span>
<span class="sd">        Returns:</span>
<span class="sd">            dict[str, str | int | float | None].</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get_all_metadata</span><span class="p">()</span>

    <span class="nd">@typechecked</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reference</span><span class="p">:</span> <span class="n">FrameSettings</span> <span class="o">|</span> <span class="n">PairedFrameSettings</span> <span class="o">|</span> <span class="n">BaseMetadata</span><span class="p">,</span>
                 <span class="n">attributes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method for evaluating whether the metadata contained in a given FramSettings instance or Metadata instance are a</span>
<span class="sd">        match based on the given sequence of attributes, which act as keys to the metadata dictionary in a Metadata</span>
<span class="sd">        instance.</span>
<span class="sd">        Args:</span>
<span class="sd">            reference: a FrameSettings instance or a BaseMetadata subclass instance.</span>
<span class="sd">            attributes: a sequence of string, which define the dictionary keys, whose associated values must be equal</span>
<span class="sd">                for a successful match.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool, True for a successful match, False for failed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="p">(</span><span class="n">FrameSettings</span><span class="p">,</span> <span class="n">PairedFrameSettings</span><span class="p">)):</span>
            <span class="n">reference_metadata</span> <span class="o">=</span> <span class="n">reference</span><span class="o">.</span><span class="n">metadata</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">BaseMetadata</span><span class="p">):</span>
            <span class="n">reference_metadata</span> <span class="o">=</span> <span class="n">reference</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">is_match</span><span class="p">(</span><span class="n">reference_metadata</span><span class="p">,</span> <span class="n">attributes</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="clair_torch.common.FrameSettings.get_all_metadata" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_all_metadata</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Method for getting all the metadata managed by the encapsulated Metadata class.
Returns:
    dict[str, str | int | float | None].</p>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/file_settings.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_all_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method for getting all the metadata managed by the encapsulated Metadata class.</span>
<span class="sd">    Returns:</span>
<span class="sd">        dict[str, str | int | float | None].</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get_all_metadata</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="clair_torch.common.FrameSettings.get_numeric_metadata" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_numeric_metadata</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Method for getting the numeric metadata managed by the encapsulated Metadata class.
Returns:
    dict[str, int | float].</p>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/file_settings.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_numeric_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method for getting the numeric metadata managed by the encapsulated Metadata class.</span>
<span class="sd">    Returns:</span>
<span class="sd">        dict[str, int | float].</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get_numeric_metadata</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="clair_torch.common.FrameSettings.get_text_metadata" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_text_metadata</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Method for getting the text metadata managed by the encapsulated Metadata class.
Returns:
    dict[str, str].</p>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/file_settings.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_text_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method for getting the text metadata managed by the encapsulated Metadata class.</span>
<span class="sd">    Returns:</span>
<span class="sd">        dict[str, str].</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get_text_metadata</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="clair_torch.common.FrameSettings.is_match" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_match</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">attributes</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Method for evaluating whether the metadata contained in a given FramSettings instance or Metadata instance are a
match based on the given sequence of attributes, which act as keys to the metadata dictionary in a Metadata
instance.
Args:
    reference: a FrameSettings instance or a BaseMetadata subclass instance.
    attributes: a sequence of string, which define the dictionary keys, whose associated values must be equal
        for a successful match.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>bool, True for a successful match, False for failed.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/file_settings.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@typechecked</span>
<span class="k">def</span><span class="w"> </span><span class="nf">is_match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reference</span><span class="p">:</span> <span class="n">FrameSettings</span> <span class="o">|</span> <span class="n">PairedFrameSettings</span> <span class="o">|</span> <span class="n">BaseMetadata</span><span class="p">,</span>
             <span class="n">attributes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method for evaluating whether the metadata contained in a given FramSettings instance or Metadata instance are a</span>
<span class="sd">    match based on the given sequence of attributes, which act as keys to the metadata dictionary in a Metadata</span>
<span class="sd">    instance.</span>
<span class="sd">    Args:</span>
<span class="sd">        reference: a FrameSettings instance or a BaseMetadata subclass instance.</span>
<span class="sd">        attributes: a sequence of string, which define the dictionary keys, whose associated values must be equal</span>
<span class="sd">            for a successful match.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool, True for a successful match, False for failed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="p">(</span><span class="n">FrameSettings</span><span class="p">,</span> <span class="n">PairedFrameSettings</span><span class="p">)):</span>
        <span class="n">reference_metadata</span> <span class="o">=</span> <span class="n">reference</span><span class="o">.</span><span class="n">metadata</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">BaseMetadata</span><span class="p">):</span>
        <span class="n">reference_metadata</span> <span class="o">=</span> <span class="n">reference</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">is_match</span><span class="p">(</span><span class="n">reference_metadata</span><span class="p">,</span> <span class="n">attributes</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="clair_torch.common.InterpMode" class="doc doc-heading">
            <code>InterpMode</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="enum.Enum">Enum</span></code></p>


        <p>Manages the interpolation modes used in ICRF model classes.</p>








              <details class="quote">
                <summary>Source code in <code>clair_torch/common/enums.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">InterpMode</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Manages the interpolation modes used in ICRF model classes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">LOOKUP</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># nearest-neighbour LUT, no-grad fast path</span>
    <span class="n">LINEAR</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
    <span class="n">CATMULL</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="clair_torch.common.MissingStdMode" class="doc doc-heading">
            <code>MissingStdMode</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="enum.Enum">Enum</span></code></p>


        <p>Manages how missing uncertainty images are dealt with in ImageDataset classes.</p>








              <details class="quote">
                <summary>Source code in <code>clair_torch/common/enums.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MissingStdMode</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Manages how missing uncertainty images are dealt with in ImageDataset classes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">NONE</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
    <span class="n">CONSTANT</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
    <span class="n">MULTIPLIER</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="clair_torch.common.Normalize" class="doc doc-heading">
            <code>Normalize</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="BaseTransform (clair_torch.common.transforms.BaseTransform)" href="#clair_torch.common.BaseTransform">BaseTransform</a></code></p>


        <p>Transform for normalizing a tensor by a minimum and maximum value.
If no values are given, dynamically use min and max of the given tensor.</p>








              <details class="quote">
                <summary>Source code in <code>clair_torch/common/transforms.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@_register_transform</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Normalize</span><span class="p">(</span><span class="n">BaseTransform</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transform for normalizing a tensor by a minimum and maximum value.</span>
<span class="sd">    If no values are given, dynamically use min and max of the given tensor.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@typechecked</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_val</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">min_val</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">target_range</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="n">target_range</span> <span class="o">=</span> <span class="n">normalize_container</span><span class="p">(</span><span class="n">target_range</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">convert_if_iterable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">max_val</span> <span class="o">=</span> <span class="n">max_val</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_val</span> <span class="o">=</span> <span class="n">min_val</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_range</span> <span class="o">=</span> <span class="n">target_range</span>

    <span class="nd">@typechecked</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">normalize_tensor</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">max_val</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_val</span><span class="p">,</span> <span class="n">min_val</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">min_val</span><span class="p">,</span> <span class="n">target_range</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">target_range</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_config</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;max_val&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_val</span><span class="p">,</span>
            <span class="s2">&quot;min_val&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_val</span><span class="p">,</span>
            <span class="s2">&quot;target_range&quot;</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_range</span><span class="p">),</span>
        <span class="p">}</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="clair_torch.common.PairedFileSettings" class="doc doc-heading">
            <code>PairedFileSettings</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="FileSettings (clair_torch.common.file_settings.FileSettings)" href="#clair_torch.common.FileSettings">FileSettings</a></code></p>


        <p>Class for managing input and output paths of a pair of arbitrary files. Main use is to handle the paired IO
operations of a value image and its associated uncertainty image. Composed of two instances of FileSettings.</p>
<h4 id="clair_torch.common.PairedFileSettings--attributes">Attributes:</h4>
<p>Inherits attributes from FileSettings.</p>








              <details class="quote">
                <summary>Source code in <code>clair_torch/common/file_settings.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">PairedFileSettings</span><span class="p">(</span><span class="n">FileSettings</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for managing input and output paths of a pair of arbitrary files. Main use is to handle the paired IO</span>
<span class="sd">    operations of a value image and its associated uncertainty image. Composed of two instances of FileSettings.</span>

<span class="sd">    Attributes:</span>
<span class="sd">    -----------</span>
<span class="sd">    Inherits attributes from FileSettings.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@typechecked</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val_input_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span> <span class="n">std_input_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">val_output_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">std_output_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">default_output_root</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">val_cpu_transforms</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BaseTransform</span> <span class="o">|</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">BaseTransform</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">std_cpu_transforms</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BaseTransform</span> <span class="o">|</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">BaseTransform</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes a PairedFileSettings object with the given paths. The class both inherits from FileSettings and is</span>
<span class="sd">        a composition of two instances of FileSettings. Referring to self.val_input_path is the same as referring to</span>
<span class="sd">        self.val_settings.input_path, same follows for other attributes. PairedFileSettings should only be used when an</span>
<span class="sd">        uncertainty input file does exist, even though the std_input_path parameter is Optional. The optionality is left</span>
<span class="sd">        to enable easy implicit seeking of std files. Use regular FileSettings if no uncertainty files are to be used.</span>
<span class="sd">        Args:</span>
<span class="sd">            val_input_path: input path for the main value file.</span>
<span class="sd">            std_input_path: input path for the associated uncertainty file.</span>
<span class="sd">            val_output_path: output path for the modified value file.</span>
<span class="sd">            std_output_path: output path for the modified uncertainty file.</span>
<span class="sd">            default_output_root: a root directory path to utilize if no output_path is given.</span>
<span class="sd">            val_cpu_transforms: transform operations for the value file.</span>
<span class="sd">            std_cpu_transforms transform operations for the uncertainty file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">val_input_path</span><span class="p">,</span> <span class="n">val_output_path</span><span class="p">,</span> <span class="n">default_output_root</span><span class="p">,</span> <span class="n">val_cpu_transforms</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">val_settings</span> <span class="o">=</span> <span class="n">FileSettings</span><span class="p">(</span>
            <span class="n">val_input_path</span><span class="p">,</span>
            <span class="n">output_path</span><span class="o">=</span><span class="n">val_output_path</span><span class="p">,</span>
            <span class="n">default_output_root</span><span class="o">=</span><span class="n">default_output_root</span><span class="p">,</span>
            <span class="n">cpu_transforms</span><span class="o">=</span><span class="n">val_cpu_transforms</span>
        <span class="p">)</span>

        <span class="c1"># This enables implicit seeking of STD files, when no STD input file is directly given.</span>
        <span class="k">if</span> <span class="n">std_input_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">candidate_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">val_settings</span><span class="o">.</span><span class="n">input_path</span><span class="o">.</span><span class="n">stem</span> <span class="o">+</span> <span class="s2">&quot; STD&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">val_settings</span><span class="o">.</span><span class="n">input_path</span><span class="o">.</span><span class="n">suffix</span>
            <span class="n">std_input_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">val_settings</span><span class="o">.</span><span class="n">input_path</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="n">candidate_name</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">std_settings</span> <span class="o">=</span> <span class="n">FileSettings</span><span class="p">(</span>
            <span class="n">std_input_path</span><span class="p">,</span>
            <span class="n">output_path</span><span class="o">=</span><span class="n">std_output_path</span><span class="p">,</span>
            <span class="n">default_output_root</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">val_settings</span><span class="o">.</span><span class="n">default_output_root</span><span class="p">,</span>
            <span class="n">cpu_transforms</span><span class="o">=</span><span class="n">std_cpu_transforms</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_input_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="n">Path</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method for getting the input paths of a PairedFileSettings instance. Overrides the inherited method by deferring</span>
<span class="sd">        the process for the two encapsulated instances.</span>
<span class="sd">        Returns:</span>
<span class="sd">            Tuple of Paths, first for value file, second for uncertainty file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">val_settings</span><span class="o">.</span><span class="n">get_input_paths</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">std_settings</span><span class="o">.</span><span class="n">get_input_paths</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_output_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="n">Path</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method for getting the output paths of a PairedFileSettings instance. Overrides the inherited method by deferring</span>
<span class="sd">        the process for the two encapsulated instances.</span>
<span class="sd">        Returns:</span>
<span class="sd">            Tuple of paths, first for value file, second for uncertainty file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">val_settings</span><span class="o">.</span><span class="n">get_output_paths</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">std_settings</span><span class="o">.</span><span class="n">get_output_paths</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_transforms</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">BaseTransform</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">BaseTransform</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method for getting the transformation operations. Overrides the inherited method by deferring the process for</span>
<span class="sd">        the two encapsulated instances.</span>
<span class="sd">        Returns:</span>
<span class="sd">            Tuple of Lists of Transforms, first for value file Transforms, second for uncertainty file Transforms.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">val_settings</span><span class="o">.</span><span class="n">get_transforms</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">std_settings</span><span class="o">.</span><span class="n">get_transforms</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="clair_torch.common.PairedFileSettings.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">val_input_path</span><span class="p">,</span> <span class="n">std_input_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">val_output_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">std_output_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">default_output_root</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">val_cpu_transforms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">std_cpu_transforms</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initializes a PairedFileSettings object with the given paths. The class both inherits from FileSettings and is
a composition of two instances of FileSettings. Referring to self.val_input_path is the same as referring to
self.val_settings.input_path, same follows for other attributes. PairedFileSettings should only be used when an
uncertainty input file does exist, even though the std_input_path parameter is Optional. The optionality is left
to enable easy implicit seeking of std files. Use regular FileSettings if no uncertainty files are to be used.
Args:
    val_input_path: input path for the main value file.
    std_input_path: input path for the associated uncertainty file.
    val_output_path: output path for the modified value file.
    std_output_path: output path for the modified uncertainty file.
    default_output_root: a root directory path to utilize if no output_path is given.
    val_cpu_transforms: transform operations for the value file.
    std_cpu_transforms transform operations for the uncertainty file.</p>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/file_settings.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@typechecked</span>
<span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val_input_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span> <span class="n">std_input_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">val_output_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">std_output_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">default_output_root</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">val_cpu_transforms</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BaseTransform</span> <span class="o">|</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">BaseTransform</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">std_cpu_transforms</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BaseTransform</span> <span class="o">|</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">BaseTransform</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initializes a PairedFileSettings object with the given paths. The class both inherits from FileSettings and is</span>
<span class="sd">    a composition of two instances of FileSettings. Referring to self.val_input_path is the same as referring to</span>
<span class="sd">    self.val_settings.input_path, same follows for other attributes. PairedFileSettings should only be used when an</span>
<span class="sd">    uncertainty input file does exist, even though the std_input_path parameter is Optional. The optionality is left</span>
<span class="sd">    to enable easy implicit seeking of std files. Use regular FileSettings if no uncertainty files are to be used.</span>
<span class="sd">    Args:</span>
<span class="sd">        val_input_path: input path for the main value file.</span>
<span class="sd">        std_input_path: input path for the associated uncertainty file.</span>
<span class="sd">        val_output_path: output path for the modified value file.</span>
<span class="sd">        std_output_path: output path for the modified uncertainty file.</span>
<span class="sd">        default_output_root: a root directory path to utilize if no output_path is given.</span>
<span class="sd">        val_cpu_transforms: transform operations for the value file.</span>
<span class="sd">        std_cpu_transforms transform operations for the uncertainty file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">val_input_path</span><span class="p">,</span> <span class="n">val_output_path</span><span class="p">,</span> <span class="n">default_output_root</span><span class="p">,</span> <span class="n">val_cpu_transforms</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">val_settings</span> <span class="o">=</span> <span class="n">FileSettings</span><span class="p">(</span>
        <span class="n">val_input_path</span><span class="p">,</span>
        <span class="n">output_path</span><span class="o">=</span><span class="n">val_output_path</span><span class="p">,</span>
        <span class="n">default_output_root</span><span class="o">=</span><span class="n">default_output_root</span><span class="p">,</span>
        <span class="n">cpu_transforms</span><span class="o">=</span><span class="n">val_cpu_transforms</span>
    <span class="p">)</span>

    <span class="c1"># This enables implicit seeking of STD files, when no STD input file is directly given.</span>
    <span class="k">if</span> <span class="n">std_input_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">candidate_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">val_settings</span><span class="o">.</span><span class="n">input_path</span><span class="o">.</span><span class="n">stem</span> <span class="o">+</span> <span class="s2">&quot; STD&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">val_settings</span><span class="o">.</span><span class="n">input_path</span><span class="o">.</span><span class="n">suffix</span>
        <span class="n">std_input_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">val_settings</span><span class="o">.</span><span class="n">input_path</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="n">candidate_name</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">std_settings</span> <span class="o">=</span> <span class="n">FileSettings</span><span class="p">(</span>
        <span class="n">std_input_path</span><span class="p">,</span>
        <span class="n">output_path</span><span class="o">=</span><span class="n">std_output_path</span><span class="p">,</span>
        <span class="n">default_output_root</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">val_settings</span><span class="o">.</span><span class="n">default_output_root</span><span class="p">,</span>
        <span class="n">cpu_transforms</span><span class="o">=</span><span class="n">std_cpu_transforms</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="clair_torch.common.PairedFileSettings.get_input_paths" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_input_paths</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Method for getting the input paths of a PairedFileSettings instance. Overrides the inherited method by deferring
the process for the two encapsulated instances.
Returns:
    Tuple of Paths, first for value file, second for uncertainty file.</p>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/file_settings.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_input_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="n">Path</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method for getting the input paths of a PairedFileSettings instance. Overrides the inherited method by deferring</span>
<span class="sd">    the process for the two encapsulated instances.</span>
<span class="sd">    Returns:</span>
<span class="sd">        Tuple of Paths, first for value file, second for uncertainty file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">val_settings</span><span class="o">.</span><span class="n">get_input_paths</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">std_settings</span><span class="o">.</span><span class="n">get_input_paths</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="clair_torch.common.PairedFileSettings.get_output_paths" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_output_paths</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Method for getting the output paths of a PairedFileSettings instance. Overrides the inherited method by deferring
the process for the two encapsulated instances.
Returns:
    Tuple of paths, first for value file, second for uncertainty file.</p>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/file_settings.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_output_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="n">Path</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method for getting the output paths of a PairedFileSettings instance. Overrides the inherited method by deferring</span>
<span class="sd">    the process for the two encapsulated instances.</span>
<span class="sd">    Returns:</span>
<span class="sd">        Tuple of paths, first for value file, second for uncertainty file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">val_settings</span><span class="o">.</span><span class="n">get_output_paths</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">std_settings</span><span class="o">.</span><span class="n">get_output_paths</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="clair_torch.common.PairedFileSettings.get_transforms" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_transforms</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Method for getting the transformation operations. Overrides the inherited method by deferring the process for
the two encapsulated instances.
Returns:
    Tuple of Lists of Transforms, first for value file Transforms, second for uncertainty file Transforms.</p>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/file_settings.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_transforms</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">BaseTransform</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">BaseTransform</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method for getting the transformation operations. Overrides the inherited method by deferring the process for</span>
<span class="sd">    the two encapsulated instances.</span>
<span class="sd">    Returns:</span>
<span class="sd">        Tuple of Lists of Transforms, first for value file Transforms, second for uncertainty file Transforms.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">val_settings</span><span class="o">.</span><span class="n">get_transforms</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">std_settings</span><span class="o">.</span><span class="n">get_transforms</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="clair_torch.common.PairedFrameSettings" class="doc doc-heading">
            <code>PairedFrameSettings</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="PairedFileSettings (clair_torch.common.file_settings.PairedFileSettings)" href="#clair_torch.common.PairedFileSettings">PairedFileSettings</a></code></p>


        <p>Class for managing paired files with their associated metadatas, based on the PairedFileSettings class.</p>
<h4 id="clair_torch.common.PairedFrameSettings--attributes">Attributes:</h4>
<p>Inherits attributes from PairedFileSettings.
val_metadata: BaseMetadata
    an encapsulated instance of a BaseMetadata subclass for managing the metadata related to the value image.
std_metadata: BaseMetadata
    an encapsulated instance of a BaseMetadata subclass for managing the metadata related to the possible uncertainty
    image. Typically, these are equal to the val_metadata values, so by default this is not parsed. The parse_std_meta
    init argument is used to determine whether the std_metadata is parsed or not.</p>








              <details class="quote">
                <summary>Source code in <code>clair_torch/common/file_settings.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">PairedFrameSettings</span><span class="p">(</span><span class="n">PairedFileSettings</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for managing paired files with their associated metadatas, based on the PairedFileSettings class.</span>

<span class="sd">    Attributes:</span>
<span class="sd">    -----------</span>
<span class="sd">    Inherits attributes from PairedFileSettings.</span>
<span class="sd">    val_metadata: BaseMetadata</span>
<span class="sd">        an encapsulated instance of a BaseMetadata subclass for managing the metadata related to the value image.</span>
<span class="sd">    std_metadata: BaseMetadata</span>
<span class="sd">        an encapsulated instance of a BaseMetadata subclass for managing the metadata related to the possible uncertainty</span>
<span class="sd">        image. Typically, these are equal to the val_metadata values, so by default this is not parsed. The parse_std_meta</span>
<span class="sd">        init argument is used to determine whether the std_metadata is parsed or not.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@typechecked</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val_input_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span> <span class="n">std_input_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">val_output_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">std_output_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">default_output_root</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">val_cpu_transforms</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BaseTransform</span> <span class="o">|</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">BaseTransform</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">std_cpu_transforms</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BaseTransform</span> <span class="o">|</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">BaseTransform</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">parse_std_meta</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">metadata_cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">BaseMetadata</span><span class="p">]</span> <span class="o">=</span> <span class="n">ImagingMetadata</span><span class="p">,</span>
                 <span class="o">*</span><span class="n">metadata_args</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata_kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        File settings related aspects are all delegated to the PairedFileSettings super class. Additional responsibility</span>
<span class="sd">        for this class is maintaining and allowing access to the metadatas of each of the encapsulated files via</span>
<span class="sd">        subclasses of BaseMetadata.</span>
<span class="sd">        Args:</span>
<span class="sd">            val_input_path: input path for the main value file.</span>
<span class="sd">            std_input_path: input path for the associated uncertainty file.</span>
<span class="sd">            val_output_path: output path for the modified value file.</span>
<span class="sd">            std_output_path: output path for the modified uncertainty file.</span>
<span class="sd">            default_output_root: a root directory path to utilize if no output_path is given.</span>
<span class="sd">            val_cpu_transforms: transform operations for the value file.</span>
<span class="sd">            std_cpu_transforms transform operations for the uncertainty file.</span>
<span class="sd">            parse_std_meta: whether to parse a Metadata class instance for the STD file.</span>
<span class="sd">            metadata_cls: a subclass of BaseMetadata</span>
<span class="sd">            *metadata_args: additional args to pass to instantiating the given metadata_cls.</span>
<span class="sd">            **metadata_kwargs: additional kwargs to pass to instantiating the given metadata_cls.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">val_input_path</span><span class="p">,</span> <span class="n">std_input_path</span><span class="p">,</span> <span class="n">val_output_path</span><span class="p">,</span> <span class="n">std_output_path</span><span class="p">,</span> <span class="n">default_output_root</span><span class="p">,</span>
                         <span class="n">val_cpu_transforms</span><span class="p">,</span> <span class="n">std_cpu_transforms</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">val_metadata</span> <span class="o">=</span> <span class="n">metadata_cls</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">val_settings</span><span class="o">.</span><span class="n">input_path</span><span class="p">,</span> <span class="o">*</span><span class="n">metadata_args</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata_kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">std_metadata</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">metadata_cls</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">std_settings</span><span class="o">.</span><span class="n">input_path</span><span class="p">,</span> <span class="o">*</span><span class="n">metadata_args</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata_kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">parse_std_meta</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">std_settings</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_numeric_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method for getting the numeric metadata of the value image.</span>
<span class="sd">        Returns:</span>
<span class="sd">            dict[str, float | int | None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">val_metadata</span><span class="o">.</span><span class="n">get_numeric_metadata</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_text_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method for getting the text metadata of the value image.</span>
<span class="sd">        Returns:</span>
<span class="sd">            dict[str, str | None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">val_metadata</span><span class="o">.</span><span class="n">get_text_metadata</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_all_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method for getting all the metadata of the value image.</span>
<span class="sd">        Returns:</span>
<span class="sd">            dict[str, str | int | float | None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">val_metadata</span><span class="o">.</span><span class="n">get_all_metadata</span><span class="p">()</span>

    <span class="nd">@typechecked</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reference</span><span class="p">:</span> <span class="n">FrameSettings</span> <span class="o">|</span> <span class="n">PairedFrameSettings</span> <span class="o">|</span> <span class="n">BaseMetadata</span><span class="p">,</span>
                 <span class="n">attributes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method for evaluating whether the metadata contained in a given FramSettings instance or Metadata instance are a</span>
<span class="sd">        match based on the given sequence of attributes, which act as keys to the metadata dictionary in a Metadata</span>
<span class="sd">        instance. Utilizes the val_metadata associated with the value image.</span>
<span class="sd">        Args:</span>
<span class="sd">            reference: a FrameSettings instance or a BaseMetadata subclass instance.</span>
<span class="sd">            attributes: a sequence of string, which define the dictionary keys, whose associated values must be equal</span>
<span class="sd">                for a successful match.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool, True for a successful match, False for failed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="p">(</span><span class="n">FrameSettings</span><span class="p">,</span> <span class="n">PairedFrameSettings</span><span class="p">)):</span>
            <span class="n">reference_meta</span> <span class="o">=</span> <span class="n">reference</span><span class="o">.</span><span class="n">val_metadata</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">BaseMetadata</span><span class="p">):</span>
            <span class="n">reference_meta</span> <span class="o">=</span> <span class="n">reference</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">val_metadata</span><span class="o">.</span><span class="n">is_match</span><span class="p">(</span><span class="n">reference_meta</span><span class="p">,</span> <span class="n">attributes</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="clair_torch.common.PairedFrameSettings.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">val_input_path</span><span class="p">,</span> <span class="n">std_input_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">val_output_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">std_output_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">default_output_root</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">val_cpu_transforms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">std_cpu_transforms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parse_std_meta</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">metadata_cls</span><span class="o">=</span><span class="n">ImagingMetadata</span><span class="p">,</span> <span class="o">*</span><span class="n">metadata_args</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata_kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>File settings related aspects are all delegated to the PairedFileSettings super class. Additional responsibility
for this class is maintaining and allowing access to the metadatas of each of the encapsulated files via
subclasses of BaseMetadata.
Args:
    val_input_path: input path for the main value file.
    std_input_path: input path for the associated uncertainty file.
    val_output_path: output path for the modified value file.
    std_output_path: output path for the modified uncertainty file.
    default_output_root: a root directory path to utilize if no output_path is given.
    val_cpu_transforms: transform operations for the value file.
    std_cpu_transforms transform operations for the uncertainty file.
    parse_std_meta: whether to parse a Metadata class instance for the STD file.
    metadata_cls: a subclass of BaseMetadata
    <em>metadata_args: additional args to pass to instantiating the given metadata_cls.
    </em>*metadata_kwargs: additional kwargs to pass to instantiating the given metadata_cls.</p>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/file_settings.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@typechecked</span>
<span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val_input_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span> <span class="n">std_input_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">val_output_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">std_output_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">default_output_root</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">val_cpu_transforms</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BaseTransform</span> <span class="o">|</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">BaseTransform</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">std_cpu_transforms</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BaseTransform</span> <span class="o">|</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">BaseTransform</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">parse_std_meta</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">metadata_cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">BaseMetadata</span><span class="p">]</span> <span class="o">=</span> <span class="n">ImagingMetadata</span><span class="p">,</span>
             <span class="o">*</span><span class="n">metadata_args</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata_kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    File settings related aspects are all delegated to the PairedFileSettings super class. Additional responsibility</span>
<span class="sd">    for this class is maintaining and allowing access to the metadatas of each of the encapsulated files via</span>
<span class="sd">    subclasses of BaseMetadata.</span>
<span class="sd">    Args:</span>
<span class="sd">        val_input_path: input path for the main value file.</span>
<span class="sd">        std_input_path: input path for the associated uncertainty file.</span>
<span class="sd">        val_output_path: output path for the modified value file.</span>
<span class="sd">        std_output_path: output path for the modified uncertainty file.</span>
<span class="sd">        default_output_root: a root directory path to utilize if no output_path is given.</span>
<span class="sd">        val_cpu_transforms: transform operations for the value file.</span>
<span class="sd">        std_cpu_transforms transform operations for the uncertainty file.</span>
<span class="sd">        parse_std_meta: whether to parse a Metadata class instance for the STD file.</span>
<span class="sd">        metadata_cls: a subclass of BaseMetadata</span>
<span class="sd">        *metadata_args: additional args to pass to instantiating the given metadata_cls.</span>
<span class="sd">        **metadata_kwargs: additional kwargs to pass to instantiating the given metadata_cls.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">val_input_path</span><span class="p">,</span> <span class="n">std_input_path</span><span class="p">,</span> <span class="n">val_output_path</span><span class="p">,</span> <span class="n">std_output_path</span><span class="p">,</span> <span class="n">default_output_root</span><span class="p">,</span>
                     <span class="n">val_cpu_transforms</span><span class="p">,</span> <span class="n">std_cpu_transforms</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">val_metadata</span> <span class="o">=</span> <span class="n">metadata_cls</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">val_settings</span><span class="o">.</span><span class="n">input_path</span><span class="p">,</span> <span class="o">*</span><span class="n">metadata_args</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata_kwargs</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">std_metadata</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">metadata_cls</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">std_settings</span><span class="o">.</span><span class="n">input_path</span><span class="p">,</span> <span class="o">*</span><span class="n">metadata_args</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata_kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">parse_std_meta</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">std_settings</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">else</span> <span class="kc">None</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="clair_torch.common.PairedFrameSettings.get_all_metadata" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_all_metadata</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Method for getting all the metadata of the value image.
Returns:
    dict[str, str | int | float | None]</p>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/file_settings.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_all_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method for getting all the metadata of the value image.</span>
<span class="sd">    Returns:</span>
<span class="sd">        dict[str, str | int | float | None]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">val_metadata</span><span class="o">.</span><span class="n">get_all_metadata</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="clair_torch.common.PairedFrameSettings.get_numeric_metadata" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_numeric_metadata</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Method for getting the numeric metadata of the value image.
Returns:
    dict[str, float | int | None]</p>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/file_settings.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_numeric_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method for getting the numeric metadata of the value image.</span>
<span class="sd">    Returns:</span>
<span class="sd">        dict[str, float | int | None]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">val_metadata</span><span class="o">.</span><span class="n">get_numeric_metadata</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="clair_torch.common.PairedFrameSettings.get_text_metadata" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_text_metadata</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Method for getting the text metadata of the value image.
Returns:
    dict[str, str | None]</p>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/file_settings.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_text_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method for getting the text metadata of the value image.</span>
<span class="sd">    Returns:</span>
<span class="sd">        dict[str, str | None]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">val_metadata</span><span class="o">.</span><span class="n">get_text_metadata</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="clair_torch.common.PairedFrameSettings.is_match" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_match</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">attributes</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Method for evaluating whether the metadata contained in a given FramSettings instance or Metadata instance are a
match based on the given sequence of attributes, which act as keys to the metadata dictionary in a Metadata
instance. Utilizes the val_metadata associated with the value image.
Args:
    reference: a FrameSettings instance or a BaseMetadata subclass instance.
    attributes: a sequence of string, which define the dictionary keys, whose associated values must be equal
        for a successful match.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>bool, True for a successful match, False for failed.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/file_settings.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@typechecked</span>
<span class="k">def</span><span class="w"> </span><span class="nf">is_match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reference</span><span class="p">:</span> <span class="n">FrameSettings</span> <span class="o">|</span> <span class="n">PairedFrameSettings</span> <span class="o">|</span> <span class="n">BaseMetadata</span><span class="p">,</span>
             <span class="n">attributes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method for evaluating whether the metadata contained in a given FramSettings instance or Metadata instance are a</span>
<span class="sd">    match based on the given sequence of attributes, which act as keys to the metadata dictionary in a Metadata</span>
<span class="sd">    instance. Utilizes the val_metadata associated with the value image.</span>
<span class="sd">    Args:</span>
<span class="sd">        reference: a FrameSettings instance or a BaseMetadata subclass instance.</span>
<span class="sd">        attributes: a sequence of string, which define the dictionary keys, whose associated values must be equal</span>
<span class="sd">            for a successful match.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool, True for a successful match, False for failed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="p">(</span><span class="n">FrameSettings</span><span class="p">,</span> <span class="n">PairedFrameSettings</span><span class="p">)):</span>
        <span class="n">reference_meta</span> <span class="o">=</span> <span class="n">reference</span><span class="o">.</span><span class="n">val_metadata</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">BaseMetadata</span><span class="p">):</span>
        <span class="n">reference_meta</span> <span class="o">=</span> <span class="n">reference</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">val_metadata</span><span class="o">.</span><span class="n">is_match</span><span class="p">(</span><span class="n">reference_meta</span><span class="p">,</span> <span class="n">attributes</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="clair_torch.common.StridedDownscale" class="doc doc-heading">
            <code>StridedDownscale</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="BaseTransform (clair_torch.common.transforms.BaseTransform)" href="#clair_torch.common.BaseTransform">BaseTransform</a></code></p>


        <p>Transform for applying a spatial downscale on the input tensor.</p>








              <details class="quote">
                <summary>Source code in <code>clair_torch/common/transforms.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@_register_transform</span>
<span class="k">class</span><span class="w"> </span><span class="nc">StridedDownscale</span><span class="p">(</span><span class="n">BaseTransform</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transform for applying a spatial downscale on the input tensor.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@typechecked</span><span class="p">()</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">step_size</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;step_size must be non-negative.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">step_size</span> <span class="o">=</span> <span class="n">step_size</span>

    <span class="nd">@typechecked</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>

        <span class="n">strided</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">::</span><span class="bp">self</span><span class="o">.</span><span class="n">step_size</span><span class="p">,</span> <span class="p">::</span><span class="bp">self</span><span class="o">.</span><span class="n">step_size</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">strided</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_config</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;step_size&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">step_size</span>
        <span class="p">}</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="clair_torch.common.TorchToCv" class="doc doc-heading">
            <code>TorchToCv</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="BaseTransform (clair_torch.common.transforms.BaseTransform)" href="#clair_torch.common.BaseTransform">BaseTransform</a></code></p>


        <p>Transform for converting a tensor from PyTorch (C, H, W) format with RGB channels to OpenCV format (H, W, C) with
BGR channels.</p>








              <details class="quote">
                <summary>Source code in <code>clair_torch/common/transforms.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@_register_transform</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TorchToCv</span><span class="p">(</span><span class="n">BaseTransform</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transform for converting a tensor from PyTorch (C, H, W) format with RGB channels to OpenCV format (H, W, C) with</span>
<span class="sd">    BGR channels.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="k">pass</span>

    <span class="nd">@typechecked</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>

        <span class="k">return</span> <span class="n">torch_to_cv</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_config</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="clair_torch.common.VarianceMode" class="doc doc-heading">
            <code>VarianceMode</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="enum.Enum">Enum</span></code></p>


        <p>Manages how the variance is computed in the WBOMeanVar class.</p>








              <details class="quote">
                <summary>Source code in <code>clair_torch/common/enums.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">VarianceMode</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Manages how the variance is computed in the WBOMeanVar class.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">POPULATION</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
    <span class="n">SAMPLE_FREQUENCY</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
    <span class="n">RELIABILITY_WEIGHTS</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="clair_torch.common.WBOMean" class="doc doc-heading">
            <code>WBOMean</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="object">object</span></code></p>









              <details class="quote">
                <summary>Source code in <code>clair_torch/common/statistics.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">WBOMean</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="nd">@typechecked</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Weighted batched online mean (WBOMean). Allows the computation of a weighted mean value of a dataset in a single</span>
<span class="sd">        pass. Attributes are read-only properties and the user only needs to assign the dimension(s) over which the</span>
<span class="sd">        value is computed and supply the batches of new values and their associated weights.</span>
<span class="sd">        Args:</span>
<span class="sd">            dim: the dimension(s) along which to compute the values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">dim</span> <span class="o">=</span> <span class="p">(</span><span class="n">dim</span><span class="p">,)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expected dim as int or tuple of int, got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_dim</span> <span class="o">=</span> <span class="n">dim</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mean</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sum_of_weights</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">mean</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mean</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">sum_of_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sum_of_weights</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">dim</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dim</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">internal_detach</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Break the autograd graph attached to the internal state.</span>
<span class="sd">        Args:</span>
<span class="sd">            in_place: Whether to call detach so the tensor is modified in-place or to put into a new tensor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">is_tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mean</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">in_place</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mean</span><span class="o">.</span><span class="n">detach_</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mean</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">is_tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sum_of_weights</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">in_place</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sum_of_weights</span><span class="o">.</span><span class="n">detach_</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sum_of_weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sum_of_weights</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>

    <span class="nd">@typechecked</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch_values</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">batch_weights</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The public method for updating the weighted mean value. Returns the new mean on update.</span>
<span class="sd">        Args:</span>
<span class="sd">            batch_values: the new batch of values used for updating the collective weighted mean.</span>
<span class="sd">            batch_weights: the new batch of weights associated with the given batch_values.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The new mean value as a float or Tensor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">batch_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="n">batch_values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">])))</span>

        <span class="k">if</span> <span class="n">batch_weights</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">total_batch_weights</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">batch_weights</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">total_batch_mean</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">batch_weights</span> <span class="o">*</span> <span class="n">batch_values</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
                    <span class="n">total_batch_weights</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">total_batch_mean</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">batch_values</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">total_batch_weights</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">total_batch_mean</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">batch_values</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_update_internal_values</span><span class="p">(</span><span class="n">total_batch_mean</span><span class="p">,</span> <span class="n">total_batch_weights</span><span class="p">,</span>
                                     <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_update_internal_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">total_batch_mean</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">total_batch_weights</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
                                <span class="n">total_squared_batch_weights</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">total_batch_variance</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Implementation of the updating of the weighted mean according to DOI 10.1007/s00180-015-0637-z.</span>
<span class="sd">        Args:</span>
<span class="sd">            total_batch_mean: the mean of the new batch.</span>
<span class="sd">            total_batch_weights: the sum of the weights in the new batch.</span>
<span class="sd">            total_squared_batch_weights: unused dummy variable for inheriting class.</span>
<span class="sd">            total_batch_variance: unused dummy variable for inheriting class.</span>
<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">W_A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_of_weights</span>
        <span class="n">W_B</span> <span class="o">=</span> <span class="n">total_batch_weights</span>
        <span class="n">mean_A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span>
        <span class="n">mean_B</span> <span class="o">=</span> <span class="n">total_batch_mean</span>
        <span class="n">W</span> <span class="o">=</span> <span class="n">W_A</span> <span class="o">+</span> <span class="n">W_B</span>

        <span class="n">new_mean</span> <span class="o">=</span> <span class="n">mean_A</span> <span class="o">+</span> <span class="p">(</span><span class="n">W_B</span> <span class="o">/</span> <span class="n">W</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">mean_B</span> <span class="o">-</span> <span class="n">mean_A</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_mean</span> <span class="o">=</span> <span class="n">new_mean</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sum_of_weights</span> <span class="o">=</span> <span class="n">W</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="clair_torch.common.WBOMean.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Weighted batched online mean (WBOMean). Allows the computation of a weighted mean value of a dataset in a single
pass. Attributes are read-only properties and the user only needs to assign the dimension(s) over which the
value is computed and supply the batches of new values and their associated weights.
Args:
    dim: the dimension(s) along which to compute the values.</p>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/statistics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@typechecked</span>
<span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Weighted batched online mean (WBOMean). Allows the computation of a weighted mean value of a dataset in a single</span>
<span class="sd">    pass. Attributes are read-only properties and the user only needs to assign the dimension(s) over which the</span>
<span class="sd">    value is computed and supply the batches of new values and their associated weights.</span>
<span class="sd">    Args:</span>
<span class="sd">        dim: the dimension(s) along which to compute the values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">dim</span> <span class="o">=</span> <span class="p">(</span><span class="n">dim</span><span class="p">,)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expected dim as int or tuple of int, got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_dim</span> <span class="o">=</span> <span class="n">dim</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_mean</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sum_of_weights</span> <span class="o">=</span> <span class="mf">0.0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="clair_torch.common.WBOMean.internal_detach" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">internal_detach</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Break the autograd graph attached to the internal state.
Args:
    in_place: Whether to call detach so the tensor is modified in-place or to put into a new tensor.</p>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/statistics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">internal_detach</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Break the autograd graph attached to the internal state.</span>
<span class="sd">    Args:</span>
<span class="sd">        in_place: Whether to call detach so the tensor is modified in-place or to put into a new tensor.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">is_tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mean</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">in_place</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mean</span><span class="o">.</span><span class="n">detach_</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mean</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">is_tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sum_of_weights</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">in_place</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sum_of_weights</span><span class="o">.</span><span class="n">detach_</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sum_of_weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sum_of_weights</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="clair_torch.common.WBOMean.update_values" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_values</span><span class="p">(</span><span class="n">batch_values</span><span class="p">,</span> <span class="n">batch_weights</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>The public method for updating the weighted mean value. Returns the new mean on update.
Args:
    batch_values: the new batch of values used for updating the collective weighted mean.
    batch_weights: the new batch of weights associated with the given batch_values.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The new mean value as a float or Tensor.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/statistics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@typechecked</span>
<span class="k">def</span><span class="w"> </span><span class="nf">update_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch_values</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">batch_weights</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The public method for updating the weighted mean value. Returns the new mean on update.</span>
<span class="sd">    Args:</span>
<span class="sd">        batch_values: the new batch of values used for updating the collective weighted mean.</span>
<span class="sd">        batch_weights: the new batch of weights associated with the given batch_values.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The new mean value as a float or Tensor.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">batch_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="n">batch_values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">])))</span>

    <span class="k">if</span> <span class="n">batch_weights</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">total_batch_weights</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">batch_weights</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">total_batch_mean</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">batch_weights</span> <span class="o">*</span> <span class="n">batch_values</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
                <span class="n">total_batch_weights</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">total_batch_mean</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">batch_values</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">total_batch_weights</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">total_batch_mean</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">batch_values</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_update_internal_values</span><span class="p">(</span><span class="n">total_batch_mean</span><span class="p">,</span> <span class="n">total_batch_weights</span><span class="p">,</span>
                                 <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="clair_torch.common.WBOMeanVar" class="doc doc-heading">
            <code>WBOMeanVar</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="WBOMean (clair_torch.common.statistics.WBOMean)" href="#clair_torch.common.WBOMean">WBOMean</a></code></p>









              <details class="quote">
                <summary>Source code in <code>clair_torch/common/statistics.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">WBOMeanVar</span><span class="p">(</span><span class="n">WBOMean</span><span class="p">):</span>

    <span class="nd">@typechecked</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">variance_mode</span><span class="p">:</span> <span class="n">VarianceMode</span> <span class="o">=</span> <span class="n">VarianceMode</span><span class="o">.</span><span class="n">RELIABILITY_WEIGHTS</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Weighted batched online mean and variance. Allows the computation of a weighted mean and variance of a dataset in a</span>
<span class="sd">        single pass. Attributes are read-only properties and the user only needs to assign the dimension(s) over which the</span>
<span class="sd">        value is computed and supply the batches of new values and their associated weights.</span>
<span class="sd">        Args:</span>
<span class="sd">            dim: the dimension(s) along which to compute the values.</span>
<span class="sd">            variance_mode: determines the normalization method to compute the variance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="n">dim</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_variance_mode</span> <span class="o">=</span> <span class="n">variance_mode</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_dispatch</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">VarianceMode</span><span class="o">.</span><span class="n">POPULATION</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_variance_population</span><span class="p">,</span>
            <span class="n">VarianceMode</span><span class="o">.</span><span class="n">RELIABILITY_WEIGHTS</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_variance_reliability_weights</span><span class="p">,</span>
            <span class="n">VarianceMode</span><span class="o">.</span><span class="n">SAMPLE_FREQUENCY</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_variance_sample_frequency</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_variance_mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dispatch</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown variance mode </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_variance_mode</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_m2</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sum_of_squared_weights</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">sum_of_squared_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sum_of_squared_weights</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">m2</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_m2</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">variance</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dispatch</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_variance_mode</span><span class="p">]()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_variance_sample_frequency</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_m2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sample_frequency_scale</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sum_of_weights</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_variance_reliability_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_m2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reliability_weights_scale</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sum_of_weights</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sum_of_squared_weights</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_variance_population</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_m2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_population_scale</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sum_of_weights</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_sample_frequency_scale</span><span class="p">(</span><span class="n">sum_of_weights</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">sum_of_weights</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_reliability_weights_scale</span><span class="p">(</span><span class="n">sum_of_weights</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">sum_of_squared_weights</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">sum_of_weights</span> <span class="o">-</span> <span class="n">sum_of_squared_weights</span> <span class="o">/</span> <span class="n">sum_of_weights</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_population_scale</span><span class="p">(</span><span class="n">sum_of_weights</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">sum_of_weights</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">internal_detach</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Break the autograd graph attached to the internal state.</span>
<span class="sd">        Args:</span>
<span class="sd">            in_place: Whether to call detach so the tensor is modified in-place or to put into a new tensor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">is_tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mean</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">in_place</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mean</span><span class="o">.</span><span class="n">detach_</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mean</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">is_tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_m2</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">in_place</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_m2</span><span class="o">.</span><span class="n">detach_</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_m2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_m2</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">is_tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sum_of_weights</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">in_place</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sum_of_weights</span><span class="o">.</span><span class="n">detach_</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sum_of_weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sum_of_weights</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">is_tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sum_of_squared_weights</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">in_place</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sum_of_squared_weights</span><span class="o">.</span><span class="n">detach_</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sum_of_squared_weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sum_of_squared_weights</span><span class="o">.</span><span class="n">detach_</span><span class="p">()</span>

    <span class="nd">@typechecked</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch_values</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">batch_weights</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> \
            <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The public method for updating the weighted mean value. Returns the new mean on update.</span>
<span class="sd">        Args:</span>
<span class="sd">            batch_values: the new batch of values used for updating the collective weighted mean.</span>
<span class="sd">            batch_weights: the new batch of weights associated with the given batch_values.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The new mean value and variance values as tuple of floats or tensors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">batch_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="n">batch_values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">])))</span>

        <span class="k">if</span> <span class="n">batch_weights</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">total_batch_weights</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">batch_weights</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">total_squared_batch_weights</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">batch_weights</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">total_batch_mean</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">batch_weights</span> <span class="o">*</span> <span class="n">batch_values</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
                    <span class="n">total_batch_weights</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">)</span>
            <span class="n">m2</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">batch_weights</span> <span class="o">*</span> <span class="p">(</span><span class="n">batch_values</span> <span class="o">-</span> <span class="n">total_batch_mean</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">total_batch_mean</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">batch_values</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">total_batch_weights</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">total_batch_mean</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">batch_values</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
            <span class="n">total_squared_batch_weights</span> <span class="o">=</span> <span class="n">total_batch_weights</span>
            <span class="n">m2</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">batch_values</span> <span class="o">-</span> <span class="n">total_batch_mean</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">total_batch_variance</span> <span class="o">=</span> <span class="n">m2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_update_internal_values</span><span class="p">(</span><span class="n">total_batch_mean</span><span class="p">,</span> <span class="n">total_batch_weights</span><span class="p">,</span>
                                     <span class="n">total_squared_batch_weights</span><span class="p">,</span> <span class="n">total_batch_variance</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m2</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_update_internal_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">total_batch_mean</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">total_batch_weights</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
                                <span class="n">total_squared_batch_weights</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">total_batch_variance</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Implementation of the updating of the weighted mean according to DOI 10.1007/s00180-015-0637-z.</span>
<span class="sd">        Args:</span>
<span class="sd">            total_batch_mean: the mean of the new batch.</span>
<span class="sd">            total_batch_weights: the sum of the weights in the new batch.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">W_A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_of_weights</span>
        <span class="n">W_B</span> <span class="o">=</span> <span class="n">total_batch_weights</span>
        <span class="n">M_A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m2</span>
        <span class="n">M_B</span> <span class="o">=</span> <span class="n">total_batch_variance</span>
        <span class="n">mean_A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span>
        <span class="n">mean_B</span> <span class="o">=</span> <span class="n">total_batch_mean</span>
        <span class="n">W</span> <span class="o">=</span> <span class="n">W_A</span> <span class="o">+</span> <span class="n">W_B</span>

        <span class="n">M_AB</span> <span class="o">=</span> <span class="n">M_A</span> <span class="o">+</span> <span class="n">M_B</span> <span class="o">+</span> <span class="p">(</span><span class="n">W_A</span> <span class="o">*</span> <span class="n">W_B</span> <span class="o">/</span> <span class="n">W</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">mean_B</span> <span class="o">-</span> <span class="n">mean_A</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">new_mean</span> <span class="o">=</span> <span class="n">mean_A</span> <span class="o">+</span> <span class="p">(</span><span class="n">W_B</span> <span class="o">/</span> <span class="n">W</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">mean_B</span> <span class="o">-</span> <span class="n">mean_A</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_mean</span> <span class="o">=</span> <span class="n">new_mean</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_m2</span> <span class="o">=</span> <span class="n">M_AB</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sum_of_weights</span> <span class="o">=</span> <span class="n">W</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sum_of_squared_weights</span> <span class="o">+=</span> <span class="n">total_squared_batch_weights</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="clair_torch.common.WBOMeanVar.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">variance_mode</span><span class="o">=</span><span class="n">VarianceMode</span><span class="o">.</span><span class="n">RELIABILITY_WEIGHTS</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Weighted batched online mean and variance. Allows the computation of a weighted mean and variance of a dataset in a
single pass. Attributes are read-only properties and the user only needs to assign the dimension(s) over which the
value is computed and supply the batches of new values and their associated weights.
Args:
    dim: the dimension(s) along which to compute the values.
    variance_mode: determines the normalization method to compute the variance.</p>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/statistics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@typechecked</span>
<span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">variance_mode</span><span class="p">:</span> <span class="n">VarianceMode</span> <span class="o">=</span> <span class="n">VarianceMode</span><span class="o">.</span><span class="n">RELIABILITY_WEIGHTS</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Weighted batched online mean and variance. Allows the computation of a weighted mean and variance of a dataset in a</span>
<span class="sd">    single pass. Attributes are read-only properties and the user only needs to assign the dimension(s) over which the</span>
<span class="sd">    value is computed and supply the batches of new values and their associated weights.</span>
<span class="sd">    Args:</span>
<span class="sd">        dim: the dimension(s) along which to compute the values.</span>
<span class="sd">        variance_mode: determines the normalization method to compute the variance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="n">dim</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_variance_mode</span> <span class="o">=</span> <span class="n">variance_mode</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_dispatch</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">VarianceMode</span><span class="o">.</span><span class="n">POPULATION</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_variance_population</span><span class="p">,</span>
        <span class="n">VarianceMode</span><span class="o">.</span><span class="n">RELIABILITY_WEIGHTS</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_variance_reliability_weights</span><span class="p">,</span>
        <span class="n">VarianceMode</span><span class="o">.</span><span class="n">SAMPLE_FREQUENCY</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_variance_sample_frequency</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_variance_mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dispatch</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown variance mode </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_variance_mode</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_m2</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sum_of_squared_weights</span> <span class="o">=</span> <span class="mf">0.0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="clair_torch.common.WBOMeanVar.internal_detach" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">internal_detach</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Break the autograd graph attached to the internal state.
Args:
    in_place: Whether to call detach so the tensor is modified in-place or to put into a new tensor.</p>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/statistics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">internal_detach</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Break the autograd graph attached to the internal state.</span>
<span class="sd">    Args:</span>
<span class="sd">        in_place: Whether to call detach so the tensor is modified in-place or to put into a new tensor.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">is_tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mean</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">in_place</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mean</span><span class="o">.</span><span class="n">detach_</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mean</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">is_tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_m2</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">in_place</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_m2</span><span class="o">.</span><span class="n">detach_</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_m2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_m2</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">is_tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sum_of_weights</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">in_place</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sum_of_weights</span><span class="o">.</span><span class="n">detach_</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sum_of_weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sum_of_weights</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">is_tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sum_of_squared_weights</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">in_place</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sum_of_squared_weights</span><span class="o">.</span><span class="n">detach_</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sum_of_squared_weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sum_of_squared_weights</span><span class="o">.</span><span class="n">detach_</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="clair_torch.common.WBOMeanVar.update_values" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_values</span><span class="p">(</span><span class="n">batch_values</span><span class="p">,</span> <span class="n">batch_weights</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>The public method for updating the weighted mean value. Returns the new mean on update.
Args:
    batch_values: the new batch of values used for updating the collective weighted mean.
    batch_weights: the new batch of weights associated with the given batch_values.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<span title="float">float</span> | <span title="torch.Tensor">Tensor</span>, <span title="float">float</span> | <span title="torch.Tensor">Tensor</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The new mean value and variance values as tuple of floats or tensors.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/statistics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@typechecked</span>
<span class="k">def</span><span class="w"> </span><span class="nf">update_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch_values</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">batch_weights</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> \
        <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The public method for updating the weighted mean value. Returns the new mean on update.</span>
<span class="sd">    Args:</span>
<span class="sd">        batch_values: the new batch of values used for updating the collective weighted mean.</span>
<span class="sd">        batch_weights: the new batch of weights associated with the given batch_values.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The new mean value and variance values as tuple of floats or tensors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">batch_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="n">batch_values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">])))</span>

    <span class="k">if</span> <span class="n">batch_weights</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">total_batch_weights</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">batch_weights</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">total_squared_batch_weights</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">batch_weights</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">total_batch_mean</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">batch_weights</span> <span class="o">*</span> <span class="n">batch_values</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
                <span class="n">total_batch_weights</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">)</span>
        <span class="n">m2</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">batch_weights</span> <span class="o">*</span> <span class="p">(</span><span class="n">batch_values</span> <span class="o">-</span> <span class="n">total_batch_mean</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">total_batch_mean</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">batch_values</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">total_batch_weights</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">total_batch_mean</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">batch_values</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="n">total_squared_batch_weights</span> <span class="o">=</span> <span class="n">total_batch_weights</span>
        <span class="n">m2</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">batch_values</span> <span class="o">-</span> <span class="n">total_batch_mean</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">total_batch_variance</span> <span class="o">=</span> <span class="n">m2</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_update_internal_values</span><span class="p">(</span><span class="n">total_batch_mean</span><span class="p">,</span> <span class="n">total_batch_weights</span><span class="p">,</span>
                                 <span class="n">total_squared_batch_weights</span><span class="p">,</span> <span class="n">total_batch_variance</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m2</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="clair_torch.common.clamp_along_dims" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">clamp_along_dims</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">min_max_pairs</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Clamp a tensor along specified dimension(s).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input tensor.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dim</code>
            </td>
            <td>
                  <code><span title="int">int</span> | <span title="tuple">tuple</span>[<span title="int">int</span>, ...]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>int or tuple of ints, dimensions along which to apply min/max.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_max_pairs</code>
            </td>
            <td>
                  <code><span title="tuple">tuple</span>[<span title="float">float</span>, <span title="float">float</span>] | <span title="list">list</span>[<span title="tuple">tuple</span>[<span title="float">float</span>, <span title="float">float</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Single tuple (min, max) applied to all slices. List of tuples; length must match the number of
slices along dims.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Clamped tensor of same shape as x.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/general_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@typechecked</span>
<span class="k">def</span><span class="w"> </span><span class="nf">clamp_along_dims</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
                     <span class="n">min_max_pairs</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Clamp a tensor along specified dimension(s).</span>

<span class="sd">    Args:</span>
<span class="sd">        x: Input tensor.</span>
<span class="sd">        dim: int or tuple of ints, dimensions along which to apply min/max.</span>
<span class="sd">        min_max_pairs: Single tuple (min, max) applied to all slices. List of tuples; length must match the number of</span>
<span class="sd">            slices along dims.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Clamped tensor of same shape as x.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">dim</span> <span class="o">=</span> <span class="p">(</span><span class="n">dim</span><span class="p">,)</span>

    <span class="n">dim</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">d</span> <span class="o">%</span> <span class="n">x</span><span class="o">.</span><span class="n">ndim</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dim</span><span class="p">)</span>  <span class="c1"># handle negative dims</span>

    <span class="c1"># Determine slice shape along specified dims</span>
    <span class="n">slice_shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dim</span><span class="p">)</span>
    <span class="n">num_slices</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">slice_shape</span><span class="p">)</span><span class="o">.</span><span class="n">prod</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>

    <span class="c1"># Handle single min-max pair</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">min_max_pairs</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="n">min_max_pairs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">max</span><span class="o">=</span><span class="n">min_max_pairs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="c1"># Otherwise we expect a list of min-max pairs</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">min_max_pairs</span><span class="p">)</span> <span class="o">!=</span> <span class="n">num_slices</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expected 1 or </span><span class="si">{</span><span class="n">num_slices</span><span class="si">}</span><span class="s2"> min/max pairs, got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">min_max_pairs</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Convert min/max pairs to tensors of shape slice_shape</span>
    <span class="n">mins</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">min_max_pairs</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">slice_shape</span><span class="p">)</span>
    <span class="n">maxs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">min_max_pairs</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">slice_shape</span><span class="p">)</span>

    <span class="c1"># Create broadcasting shape</span>
    <span class="n">broadcast_shape</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">ndim</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dim</span><span class="p">):</span>
        <span class="n">broadcast_shape</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">=</span> <span class="n">slice_shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="n">mins</span> <span class="o">=</span> <span class="n">mins</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">broadcast_shape</span><span class="p">)</span>
    <span class="n">maxs</span> <span class="o">=</span> <span class="n">maxs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">broadcast_shape</span><span class="p">)</span>

    <span class="c1"># Clamp using broadcasting</span>
    <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="n">mins</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">maxs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="clair_torch.common.cli_parse_args_from_config" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cli_parse_args_from_config</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>CLI utility function to read parameter values from a .yaml config file into a dictionary.
Returns:
    dictionary of the parsed keys and values.</p>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/general_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">cli_parse_args_from_config</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    CLI utility function to read parameter values from a .yaml config file into a dictionary.</span>
<span class="sd">    Returns:</span>
<span class="sd">        dictionary of the parsed keys and values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--config&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Path to config file&quot;</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">config</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">config</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="clair_torch.common.conditional_gaussian_blur" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">conditional_gaussian_blur</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">mask_map</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">kernel_size</span><span class="p">,</span> <span class="n">differentiable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">50.0</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Apply a gaussian blur on input image positions at which the given map has value larger than the given threshold.
Optionally use a differentiable soft mask instead of a boolean mask.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>input image of shape (..., C, H, W).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mask_map</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>map for filtering. Shape must be (1, C, H, W) or (N, C, H, W),
      where N matches the batch dimension of image or is 1 (broadcasted).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>threshold</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>threshold value for filtering.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kernel_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>size of the gaussian blur kernel.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>differentiable</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if True, use a soft differentiable mask via sigmoid.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>alpha</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>steepness of sigmoid when differentiable=True.</p>
              </div>
            </td>
            <td>
                  <code>50.0</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Filtered image, same shape as input.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/general_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@typechecked</span>
<span class="k">def</span><span class="w"> </span><span class="nf">conditional_gaussian_blur</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">mask_map</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">kernel_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                              <span class="n">differentiable</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">50.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Apply a gaussian blur on input image positions at which the given map has value larger than the given threshold.</span>
<span class="sd">    Optionally use a differentiable soft mask instead of a boolean mask.</span>

<span class="sd">    Args:</span>
<span class="sd">        image: input image of shape (..., C, H, W).</span>
<span class="sd">        mask_map: map for filtering. Shape must be (1, C, H, W) or (N, C, H, W),</span>
<span class="sd">                  where N matches the batch dimension of image or is 1 (broadcasted).</span>
<span class="sd">        threshold: threshold value for filtering.</span>
<span class="sd">        kernel_size: size of the gaussian blur kernel.</span>
<span class="sd">        differentiable: if True, use a soft differentiable mask via sigmoid.</span>
<span class="sd">        alpha: steepness of sigmoid when differentiable=True.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Filtered image, same shape as input.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="o">*</span><span class="n">leading</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">W</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">image_flat</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">W</span><span class="p">)</span>  <span class="c1"># flatten leading dims into batch</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">image_flat</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">blur_transform</span> <span class="o">=</span> <span class="n">GaussianBlur</span><span class="p">(</span><span class="n">kernel_size</span><span class="o">=</span><span class="n">kernel_size</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">blurred</span> <span class="o">=</span> <span class="n">blur_transform</span><span class="p">(</span><span class="n">image_flat</span><span class="p">)</span>

    <span class="c1"># validate mask shape</span>
    <span class="k">if</span> <span class="n">mask_map</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;mask_map batch dimension must be 1 or </span><span class="si">{</span><span class="n">N</span><span class="si">}</span><span class="s2">, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;got </span><span class="si">{</span><span class="n">mask_map</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">differentiable</span><span class="p">:</span>
        <span class="c1"># smooth sigmoid mask ∈ (0, 1)</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">((</span><span class="n">mask_map</span> <span class="o">-</span> <span class="n">threshold</span><span class="p">)</span> <span class="o">*</span> <span class="n">alpha</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># boolean mask</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">mask_map</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

    <span class="c1"># broadcast mask to match image batch if needed</span>
    <span class="k">if</span> <span class="n">mask</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">N</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># mix blurred and original</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">mask</span> <span class="o">*</span> <span class="n">blurred</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">mask</span><span class="p">)</span> <span class="o">*</span> <span class="n">image_flat</span>

    <span class="k">return</span> <span class="n">out</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">*</span><span class="n">leading</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">W</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="clair_torch.common.cv_to_torch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cv_to_torch</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Function for transforming a tensor with OpenCV channel and dimension ordering into PyTorch channel and dimension
ordering. Expects a tensor with two or three dimensions.
Args:
    x: tensor to transform.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>torch.Tensor</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/general_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">cv_to_torch</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function for transforming a tensor with OpenCV channel and dimension ordering into PyTorch channel and dimension</span>
<span class="sd">    ordering. Expects a tensor with two or three dimensions.</span>
<span class="sd">    Args:</span>
<span class="sd">        x: tensor to transform.</span>

<span class="sd">    Returns:</span>
<span class="sd">        torch.Tensor</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="c1"># Grayscale image: (H, W) -&gt; (1, H, W)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">x</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="c1"># Color image: BGR to RGB, then permute to (C, H, W)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span>  <span class="c1"># BGR to RGB</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected image shape: </span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">x</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="clair_torch.common.file_settings_constructor" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">file_settings_constructor</span><span class="p">(</span><span class="n">dir_paths</span><span class="p">,</span> <span class="n">file_pattern</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default_output_root</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">val_cpu_transforms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">std_cpu_transforms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metadata_cls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">strict_exclusive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">*</span><span class="n">metadata_args</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata_kwargs</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Utility function for creating instances of FileSettings, PairedFileSettings, FrameSettings and PairedFrameSettings
classes. FrameSettings classes are created when a metadata class is provided, otherwise FileSettings are created.
The created objects are assigned to three categories, each having a list of their own to hold the objects:
1. Paired files, containing either PairedFrameSettings or PairedFileSettings objects. 2. Main files, containing
either FrameSettings or FileSettings objects. 3. Uncertainty files, containing either FrameSettings or FileSettings
objects. The strict_exclusive parameter controls whether a file can be present in the objects of multiple categories
of only one. In strict mode, for example, the main file and uncertainty file present in a PairedSettings object
aren't allowed to also be present in a Settings object in the main and uncertainty categories.
Args:
    dir_paths: one or multiple paths from which to collect files for creating objects.
    file_pattern: a regex pattern for the file search. Use '<em>.png' for example to search for any .png file.
    recursive: whether to extend the file search recursively to subdirectories of the given paths.
    default_output_root: optional default output root directory for the created objects.
    val_cpu_transforms: optional main file transform operations to attach to the created objects.
    std_cpu_transforms: optional uncertainty file transform operations to attach to the created objects.
    metadata_cls: a subclass of BaseMetadata to use in creating FrameSettings and PairedFrameSettings objects.
    strict_exclusive: whether to allow a particular file to exist in multiple object categories, or only in the
        highest priority one.
    </em>metadata_args: args for the instantiation of the given metadata_cls.
    **metadata_kwargs: kwargs for the instantiation of the given metadata_cls.</p>
<p>Returns:</p>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/file_settings.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@typechecked</span>
<span class="k">def</span><span class="w"> </span><span class="nf">file_settings_constructor</span><span class="p">(</span>
    <span class="n">dir_paths</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Path</span><span class="p">],</span>
    <span class="n">file_pattern</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">recursive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">default_output_root</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">val_cpu_transforms</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BaseTransform</span> <span class="o">|</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">BaseTransform</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">std_cpu_transforms</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BaseTransform</span> <span class="o">|</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">BaseTransform</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">metadata_cls</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">BaseMetadata</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">strict_exclusive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="o">*</span><span class="n">metadata_args</span><span class="p">,</span>
    <span class="o">**</span><span class="n">metadata_kwargs</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Utility function for creating instances of FileSettings, PairedFileSettings, FrameSettings and PairedFrameSettings</span>
<span class="sd">    classes. FrameSettings classes are created when a metadata class is provided, otherwise FileSettings are created.</span>
<span class="sd">    The created objects are assigned to three categories, each having a list of their own to hold the objects:</span>
<span class="sd">    1. Paired files, containing either PairedFrameSettings or PairedFileSettings objects. 2. Main files, containing</span>
<span class="sd">    either FrameSettings or FileSettings objects. 3. Uncertainty files, containing either FrameSettings or FileSettings</span>
<span class="sd">    objects. The strict_exclusive parameter controls whether a file can be present in the objects of multiple categories</span>
<span class="sd">    of only one. In strict mode, for example, the main file and uncertainty file present in a PairedSettings object</span>
<span class="sd">    aren&#39;t allowed to also be present in a Settings object in the main and uncertainty categories.</span>
<span class="sd">    Args:</span>
<span class="sd">        dir_paths: one or multiple paths from which to collect files for creating objects.</span>
<span class="sd">        file_pattern: a regex pattern for the file search. Use &#39;*.png&#39; for example to search for any .png file.</span>
<span class="sd">        recursive: whether to extend the file search recursively to subdirectories of the given paths.</span>
<span class="sd">        default_output_root: optional default output root directory for the created objects.</span>
<span class="sd">        val_cpu_transforms: optional main file transform operations to attach to the created objects.</span>
<span class="sd">        std_cpu_transforms: optional uncertainty file transform operations to attach to the created objects.</span>
<span class="sd">        metadata_cls: a subclass of BaseMetadata to use in creating FrameSettings and PairedFrameSettings objects.</span>
<span class="sd">        strict_exclusive: whether to allow a particular file to exist in multiple object categories, or only in the</span>
<span class="sd">            highest priority one.</span>
<span class="sd">        *metadata_args: args for the instantiation of the given metadata_cls.</span>
<span class="sd">        **metadata_kwargs: kwargs for the instantiation of the given metadata_cls.</span>

<span class="sd">    Returns:</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">make_single_settings</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">path_key</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">cpu_transforms</span><span class="p">,</span> <span class="n">path_pair</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">input_path</span><span class="o">=</span><span class="n">path_pair</span><span class="p">[</span><span class="n">path_key</span><span class="p">],</span>
            <span class="n">default_output_root</span><span class="o">=</span><span class="n">default_output_root</span><span class="p">,</span>
            <span class="n">cpu_transforms</span><span class="o">=</span><span class="n">cpu_transforms</span><span class="p">,</span>
            <span class="n">metadata_cls</span><span class="o">=</span><span class="n">metadata_cls</span> <span class="k">if</span> <span class="bp">cls</span> <span class="ow">is</span> <span class="n">FrameSettings</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="o">*</span><span class="n">metadata_args</span><span class="p">,</span>
            <span class="o">**</span><span class="n">metadata_kwargs</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">make_paired_settings</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">pair</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">val_input_path</span><span class="o">=</span><span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">std_input_path</span><span class="o">=</span><span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">default_output_root</span><span class="o">=</span><span class="n">default_output_root</span><span class="p">,</span>
            <span class="n">val_cpu_transforms</span><span class="o">=</span><span class="n">val_cpu_transforms</span><span class="p">,</span>
            <span class="n">std_cpu_transforms</span><span class="o">=</span><span class="n">std_cpu_transforms</span><span class="p">,</span>
            <span class="n">metadata_cls</span><span class="o">=</span><span class="n">metadata_cls</span> <span class="k">if</span> <span class="bp">cls</span> <span class="ow">is</span> <span class="n">PairedFrameSettings</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="o">*</span><span class="n">metadata_args</span><span class="p">,</span>
            <span class="o">**</span><span class="n">metadata_kwargs</span>
        <span class="p">)</span>

    <span class="n">search_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">dir_paths</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dir_paths</span><span class="p">,</span> <span class="n">Path</span><span class="p">)</span> <span class="k">else</span> <span class="n">dir_paths</span>

    <span class="n">all_paired</span><span class="p">,</span> <span class="n">all_main</span><span class="p">,</span> <span class="n">all_std</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">dir_path</span> <span class="ow">in</span> <span class="n">search_paths</span><span class="p">:</span>
        <span class="n">current_files</span> <span class="o">=</span> <span class="n">_get_file_input_paths_by_pattern</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">file_pattern</span><span class="p">,</span> <span class="n">recursive</span><span class="p">)</span>
        <span class="n">paired</span><span class="p">,</span> <span class="n">main</span><span class="p">,</span> <span class="n">std</span> <span class="o">=</span> <span class="n">_pair_main_and_std_files</span><span class="p">(</span><span class="n">current_files</span><span class="p">,</span> <span class="n">strict_exclusive</span><span class="o">=</span><span class="n">strict_exclusive</span><span class="p">)</span>
        <span class="n">all_paired</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">paired</span><span class="p">)</span>
        <span class="n">all_main</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">main</span><span class="p">)</span>
        <span class="n">all_std</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">std</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">metadata_cls</span><span class="p">:</span>
        <span class="n">paired_cls</span><span class="p">,</span> <span class="n">frame_cls</span> <span class="o">=</span> <span class="n">PairedFrameSettings</span><span class="p">,</span> <span class="n">FrameSettings</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">paired_cls</span><span class="p">,</span> <span class="n">frame_cls</span> <span class="o">=</span> <span class="n">PairedFileSettings</span><span class="p">,</span> <span class="n">FileSettings</span>

    <span class="n">paired_settings</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">make_paired_settings</span><span class="p">(</span><span class="n">paired_cls</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">all_paired</span><span class="p">)</span>
    <span class="n">main_settings</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">make_single_settings</span><span class="p">(</span><span class="n">frame_cls</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">val_cpu_transforms</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">all_main</span><span class="p">)</span>
    <span class="n">std_settings</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">make_single_settings</span><span class="p">(</span><span class="n">frame_cls</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">std_cpu_transforms</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">all_std</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">paired_settings</span><span class="p">,</span> <span class="n">main_settings</span><span class="p">,</span> <span class="n">std_settings</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="clair_torch.common.flat_field_mean" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">flat_field_mean</span><span class="p">(</span><span class="n">flat_field</span><span class="p">,</span> <span class="n">mid_area_side_fraction</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Computes the spatial mean over a centered square ROI for each image and channel.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>flat_field</code>
            </td>
            <td>
                  <code><span title="Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input tensor of shape (N, C, H, W)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mid_area_side_fraction</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Fraction of spatial dims to use for the ROI. Must lie in range [0.0, 1.0].</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Tensor</code></td>            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mean over the ROI, shape (...)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/general_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@typechecked</span>
<span class="k">def</span><span class="w"> </span><span class="nf">flat_field_mean</span><span class="p">(</span><span class="n">flat_field</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">mid_area_side_fraction</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the spatial mean over a centered square ROI for each image and channel.</span>

<span class="sd">    Args:</span>
<span class="sd">        flat_field (Tensor): Input tensor of shape (N, C, H, W)</span>
<span class="sd">        mid_area_side_fraction (float): Fraction of spatial dims to use for the ROI. Must lie in range [0.0, 1.0].</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tensor: Mean over the ROI, shape (...)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">mid_area_side_fraction</span> <span class="o">&gt;</span> <span class="mf">1.0</span> <span class="ow">or</span> <span class="n">mid_area_side_fraction</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;mid_area_side_fraction should be between 0.0 and 1.0&quot;</span><span class="p">)</span>

    <span class="n">N</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">W</span> <span class="o">=</span> <span class="n">flat_field</span><span class="o">.</span><span class="n">shape</span>

    <span class="n">ROI_dx</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">W</span> <span class="o">*</span> <span class="n">mid_area_side_fraction</span><span class="p">)</span>
    <span class="n">ROI_dy</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">H</span> <span class="o">*</span> <span class="n">mid_area_side_fraction</span><span class="p">)</span>

    <span class="n">ROI_start_index</span> <span class="o">=</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">mid_area_side_fraction</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="n">x_start</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">ROI_start_index</span> <span class="o">*</span> <span class="n">ROI_dx</span><span class="p">)</span>
    <span class="n">x_end</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">ROI_start_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">ROI_dx</span><span class="p">)</span>
    <span class="n">y_start</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">ROI_start_index</span> <span class="o">*</span> <span class="n">ROI_dy</span><span class="p">)</span>
    <span class="n">y_end</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">ROI_start_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">ROI_dy</span><span class="p">)</span>

    <span class="n">cropped</span> <span class="o">=</span> <span class="n">flat_field</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">y_start</span><span class="p">:</span><span class="n">y_end</span><span class="p">,</span> <span class="n">x_start</span><span class="p">:</span><span class="n">x_end</span><span class="p">]</span>  <span class="c1"># shape: (N, C, ROI_dy, ROI_dx)</span>

    <span class="k">return</span> <span class="n">cropped</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># shape: (N, C, 1, 1)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="clair_torch.common.flatfield_correction" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">flatfield_correction</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">flatfield</span><span class="p">,</span> <span class="n">flatfield_mean_val</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mf">1e-06</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Computes a flat-field corrected version of input image by utilizing the given flat-field image and a given spatial
mean. Ideally expects both images and flatfield in shape (N, C, H, W) but others are allowed. Match argument shapes
based on requirements. For example with images (N, C, H, W) use flatfield (1, C, H, W) to apply same flatfield
across the batch dimension, (N, 1, H, W) to apply unique flatfields across batch while disregarding channel specific
features. Similarly, use flatfield_mean_val (1, C, 1, 1) to apply channel-specific scaling uniformly across the batch.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>images</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Image tensor of shape (N, C, H, W).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>flatfield</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flat field calibration image, same shape as <code>images</code> or broadcastable to images.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>flatfield_mean_val</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Values used to scale the image. Match shape based on the given images and flatfield.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>epsilon</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Small constant to avoid division by zero.</p>
              </div>
            </td>
            <td>
                  <code>1e-06</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Tensor</code></td>            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Corrected image tensor, same shape as input.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/general_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@typechecked</span>
<span class="k">def</span><span class="w"> </span><span class="nf">flatfield_correction</span><span class="p">(</span><span class="n">images</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">flatfield</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">flatfield_mean_val</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
                         <span class="n">epsilon</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-6</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes a flat-field corrected version of input image by utilizing the given flat-field image and a given spatial</span>
<span class="sd">    mean. Ideally expects both images and flatfield in shape (N, C, H, W) but others are allowed. Match argument shapes</span>
<span class="sd">    based on requirements. For example with images (N, C, H, W) use flatfield (1, C, H, W) to apply same flatfield</span>
<span class="sd">    across the batch dimension, (N, 1, H, W) to apply unique flatfields across batch while disregarding channel specific</span>
<span class="sd">    features. Similarly, use flatfield_mean_val (1, C, 1, 1) to apply channel-specific scaling uniformly across the batch.</span>

<span class="sd">    Args:</span>
<span class="sd">        images: Image tensor of shape (N, C, H, W).</span>
<span class="sd">        flatfield: Flat field calibration image, same shape as `images` or broadcastable to images.</span>
<span class="sd">        flatfield_mean_val: Values used to scale the image. Match shape based on the given images and flatfield.</span>
<span class="sd">        epsilon: Small constant to avoid division by zero.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tensor: Corrected image tensor, same shape as input.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">is_broadcastable</span><span class="p">(</span><span class="n">images</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">flatfield</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">is_broadcastable</span><span class="p">(</span><span class="n">images</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">flatfield_mean_val</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">corrected_images</span> <span class="o">=</span> <span class="p">(</span><span class="n">images</span> <span class="o">/</span> <span class="p">(</span><span class="n">flatfield</span> <span class="o">+</span> <span class="n">epsilon</span><span class="p">))</span> <span class="o">*</span> <span class="n">flatfield_mean_val</span>

    <span class="k">return</span> <span class="n">corrected_images</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="clair_torch.common.get_pairwise_valid_pixel_mask" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_pairwise_valid_pixel_mask</span><span class="p">(</span><span class="n">image_value_stack</span><span class="p">,</span> <span class="n">i_idx</span><span class="p">,</span> <span class="n">j_idx</span><span class="p">,</span> <span class="n">image_std_stack</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">val_lower</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">val_upper</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">std_lower</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">std_upper</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>For a batch of images, for all pairs given by indices i_idx and j_idx, compute a pairwise boolean mask by marking
invalid pixels as False, if they lie outside the valid range defined by lower and upper, in either one of the images
in a given pair.
Args:
    image_value_stack: batch of value images, shape (N, C, H, W).
    i_idx: the first set of indices to create pairs off of, shape (P,).
    j_idx: the second set of indices to create pairs off of, shape (P,).
    image_std_stack: batch of uncertainty images associated with the images in image_value_stack, shape (N, C, H, W).
    val_lower: lower threshold for marking pixels as invalid in value image.
    val_upper: upper threshold for marking pixels as invalid in value image.
    std_lower: lower threshold for marking pixels as invalid in std image.
    std_upper: upper threshold for marking pixels as invalid in std image.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A boolean tensor that marks invalid pixel positions in a pair with False, shape (P, C, H, W).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/general_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@typechecked</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_pairwise_valid_pixel_mask</span><span class="p">(</span><span class="n">image_value_stack</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">i_idx</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">j_idx</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
                                  <span class="n">image_std_stack</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="n">val_lower</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">val_upper</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
                                  <span class="n">std_lower</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">std_upper</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    For a batch of images, for all pairs given by indices i_idx and j_idx, compute a pairwise boolean mask by marking</span>
<span class="sd">    invalid pixels as False, if they lie outside the valid range defined by lower and upper, in either one of the images</span>
<span class="sd">    in a given pair.</span>
<span class="sd">    Args:</span>
<span class="sd">        image_value_stack: batch of value images, shape (N, C, H, W).</span>
<span class="sd">        i_idx: the first set of indices to create pairs off of, shape (P,).</span>
<span class="sd">        j_idx: the second set of indices to create pairs off of, shape (P,).</span>
<span class="sd">        image_std_stack: batch of uncertainty images associated with the images in image_value_stack, shape (N, C, H, W).</span>
<span class="sd">        val_lower: lower threshold for marking pixels as invalid in value image.</span>
<span class="sd">        val_upper: upper threshold for marking pixels as invalid in value image.</span>
<span class="sd">        std_lower: lower threshold for marking pixels as invalid in std image.</span>
<span class="sd">        std_upper: upper threshold for marking pixels as invalid in std image.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A boolean tensor that marks invalid pixel positions in a pair with False, shape (P, C, H, W).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">val_lower</span> <span class="o">&gt;</span> <span class="n">val_upper</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Lower threshold cannot be a larger value than upper threshold.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">std_lower</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">std_upper</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="n">std_lower</span> <span class="o">&gt;</span> <span class="n">std_upper</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Lower threshold cannot be a larger value than upper threshold.&quot;</span><span class="p">)</span>

    <span class="c1"># Gather image pairs and reshape to (P, C, H, W)</span>
    <span class="n">val_i</span><span class="p">,</span> <span class="n">val_j</span> <span class="o">=</span> <span class="n">image_value_stack</span><span class="p">[</span><span class="n">i_idx</span><span class="p">],</span> <span class="n">image_value_stack</span><span class="p">[</span><span class="n">j_idx</span><span class="p">]</span>

    <span class="n">valid_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">val_i</span> <span class="o">&gt;=</span> <span class="n">val_lower</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val_i</span> <span class="o">&lt;=</span> <span class="n">val_upper</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val_j</span> <span class="o">&gt;=</span> <span class="n">val_lower</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val_j</span> <span class="o">&lt;=</span> <span class="n">val_upper</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">image_std_stack</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="n">std_lower</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">std_upper</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">std_i</span><span class="p">,</span> <span class="n">std_j</span> <span class="o">=</span> <span class="n">image_std_stack</span><span class="p">[</span><span class="n">i_idx</span><span class="p">],</span> <span class="n">image_std_stack</span><span class="p">[</span><span class="n">j_idx</span><span class="p">]</span>
        <span class="n">valid_std_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">std_i</span> <span class="o">&gt;=</span> <span class="n">std_lower</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">std_i</span> <span class="o">&lt;=</span> <span class="n">std_upper</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">std_j</span> <span class="o">&gt;=</span> <span class="n">std_lower</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">std_j</span> <span class="o">&lt;=</span> <span class="n">std_upper</span><span class="p">)</span>
        <span class="n">valid_mask</span> <span class="o">=</span> <span class="n">valid_mask</span> <span class="o">&amp;</span> <span class="n">valid_std_mask</span>

    <span class="k">return</span> <span class="n">valid_mask</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="clair_torch.common.get_valid_exposure_pairs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_valid_exposure_pairs</span><span class="p">(</span><span class="n">increasing_exposure_values</span><span class="p">,</span> <span class="n">exposure_ratio_threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Generate valid (i, j) index pairs for exposure comparison, based on a minimum ratio threshold.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>increasing_exposure_values</code>
            </td>
            <td>
                  <code><span title="Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Shape (N,) exposure values in an increasing order.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>exposure_ratio_threshold</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum exposure ratio to accept a pair.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<span title="torch.Tensor">Tensor</span>, <span title="torch.Tensor">Tensor</span>, <span title="torch.Tensor">Tensor</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple of:
- i_idx: (P,) indices of first images in valid pairs (i &lt; j)
- j_idx: (P,) indices of second images
- ratio_pairs: (P,) exposure ratios exposure[i] / exposure[j]</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/general_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@typechecked</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_valid_exposure_pairs</span><span class="p">(</span><span class="n">increasing_exposure_values</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">exposure_ratio_threshold</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                             <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate valid (i, j) index pairs for exposure comparison, based on a minimum ratio threshold.</span>

<span class="sd">    Args:</span>
<span class="sd">        increasing_exposure_values (Tensor): Shape (N,) exposure values in an increasing order.</span>
<span class="sd">        exposure_ratio_threshold (float, optional): Minimum exposure ratio to accept a pair.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple of:</span>
<span class="sd">            - i_idx: (P,) indices of first images in valid pairs (i &lt; j)</span>
<span class="sd">            - j_idx: (P,) indices of second images</span>
<span class="sd">            - ratio_pairs: (P,) exposure ratios exposure[i] / exposure[j]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">N</span> <span class="o">=</span> <span class="n">increasing_exposure_values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">device</span> <span class="o">=</span> <span class="n">increasing_exposure_values</span><span class="o">.</span><span class="n">device</span>
    <span class="n">ratios</span> <span class="o">=</span> <span class="n">increasing_exposure_values</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">increasing_exposure_values</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>  <span class="c1"># (N, N)</span>
    <span class="n">i_idx</span><span class="p">,</span> <span class="n">j_idx</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">triu_indices</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">i_idx</span> <span class="o">=</span> <span class="n">i_idx</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
    <span class="n">j_idx</span> <span class="o">=</span> <span class="n">j_idx</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
    <span class="n">ratio_pairs</span> <span class="o">=</span> <span class="n">ratios</span><span class="p">[</span><span class="n">i_idx</span><span class="p">,</span> <span class="n">j_idx</span><span class="p">]</span>  <span class="c1"># (P,)</span>

    <span class="k">if</span> <span class="n">exposure_ratio_threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">ratio_pairs</span> <span class="o">&gt;=</span> <span class="n">exposure_ratio_threshold</span>
        <span class="n">i_idx</span> <span class="o">=</span> <span class="n">i_idx</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
        <span class="n">j_idx</span> <span class="o">=</span> <span class="n">j_idx</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
        <span class="n">ratio_pairs</span> <span class="o">=</span> <span class="n">ratio_pairs</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">i_idx</span><span class="p">,</span> <span class="n">j_idx</span><span class="p">,</span> <span class="n">ratio_pairs</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="clair_torch.common.group_frame_settings_by_attributes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">group_frame_settings_by_attributes</span><span class="p">(</span><span class="n">list_of_frame_settings</span><span class="p">,</span> <span class="n">attributes</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Sort FrameSettings objects into separate groups based on the values of the given attributes.
Args:
    list_of_frame_settings: list of the FrameSettings to sort.
    attributes: the attributes to base the grouping on.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[<span title="dict">dict</span>[<span title="str">str</span>, <span title="str">str</span> | <span title="float">float</span> | <span title="int">int</span>], <span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="FrameSettings (clair_torch.common.file_settings.FrameSettings)" href="#clair_torch.common.FrameSettings">FrameSettings</a>]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of tuples, the first item in the tuple containing a dictionary of the attributes used to generate that</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[<span title="dict">dict</span>[<span title="str">str</span>, <span title="str">str</span> | <span title="float">float</span> | <span title="int">int</span>], <span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="FrameSettings (clair_torch.common.file_settings.FrameSettings)" href="#clair_torch.common.FrameSettings">FrameSettings</a>]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>group. The second item in the tuple contains a list of the FrameSettings objects belonging to that group.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/file_settings.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@typechecked</span>
<span class="k">def</span><span class="w"> </span><span class="nf">group_frame_settings_by_attributes</span><span class="p">(</span><span class="n">list_of_frame_settings</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">FrameSettings</span><span class="p">],</span>
                                       <span class="n">attributes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">])</span> \
        <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">FrameSettings</span><span class="p">]]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sort FrameSettings objects into separate groups based on the values of the given attributes.</span>
<span class="sd">    Args:</span>
<span class="sd">        list_of_frame_settings: list of the FrameSettings to sort.</span>
<span class="sd">        attributes: the attributes to base the grouping on.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of tuples, the first item in the tuple containing a dictionary of the attributes used to generate that</span>
<span class="sd">        group. The second item in the tuple contains a list of the FrameSettings objects belonging to that group.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">list_of_grouped_frame_settings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">list_of_group_metas</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">frame_settings</span> <span class="ow">in</span> <span class="n">list_of_frame_settings</span><span class="p">:</span>

        <span class="n">current_metas</span> <span class="o">=</span> <span class="n">frame_settings</span><span class="o">.</span><span class="n">get_all_metadata</span><span class="p">()</span>

        <span class="c1"># Generate the first group automatically.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">list_of_grouped_frame_settings</span><span class="p">:</span>

            <span class="n">group_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">frame_settings</span><span class="p">]</span>
            <span class="n">list_of_grouped_frame_settings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group_list</span><span class="p">)</span>
            <span class="n">list_of_group_metas</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="n">current_metas</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">attributes</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">current_metas</span><span class="p">})</span>
            <span class="k">continue</span>

        <span class="c1"># Loop through the current groups and check if the current frame_settings fits into any of them.</span>
        <span class="n">number_of_groups</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_grouped_frame_settings</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">group_list</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_of_grouped_frame_settings</span><span class="p">):</span>

            <span class="n">current_target_metadata</span> <span class="o">=</span> <span class="n">group_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span>
            <span class="n">candidate_metadata</span> <span class="o">=</span> <span class="n">frame_settings</span><span class="o">.</span><span class="n">metadata</span>

            <span class="c1"># Add to existing group.</span>
            <span class="k">if</span> <span class="n">current_target_metadata</span><span class="o">.</span><span class="n">is_match</span><span class="p">(</span><span class="n">candidate_metadata</span><span class="p">,</span> <span class="n">attributes</span><span class="p">):</span>
                <span class="n">group_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frame_settings</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="c1"># Generate a new group and add to it.</span>
            <span class="k">if</span> <span class="n">number_of_groups</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">additional_group_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">frame_settings</span><span class="p">]</span>
                <span class="n">list_of_grouped_frame_settings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">additional_group_list</span><span class="p">)</span>
                <span class="n">list_of_group_metas</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="n">current_metas</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">attributes</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">current_metas</span><span class="p">})</span>
                <span class="k">break</span>

    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">list_of_group_metas</span><span class="p">,</span> <span class="n">list_of_grouped_frame_settings</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="clair_torch.common.load_icrf_txt" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_icrf_txt</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">source_channel_order</span><span class="o">=</span><span class="n">ChannelOrder</span><span class="o">.</span><span class="n">BGR</span><span class="p">,</span> <span class="n">source_dimension_order</span><span class="o">=</span><span class="n">DimensionOrder</span><span class="o">.</span><span class="n">BSC</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Utility function for loading an inverse camera response function from a .txt file. Expects a 2D NumPy array
with shape (N, C), with N representing the number of datapoints
Args:
    path: path to the text file containing the ICRF data.
    source_channel_order: the order in which the channels are expected to be in the file.
    source_dimension_order: the order in which the dimensions are expected to be in the file.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>torch.Tensor representing the ICRF.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/data_io.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@typechecked</span>
<span class="k">def</span><span class="w"> </span><span class="nf">load_icrf_txt</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span> <span class="n">source_channel_order</span><span class="p">:</span> <span class="n">ChannelOrder</span> <span class="o">=</span> <span class="n">ChannelOrder</span><span class="o">.</span><span class="n">BGR</span><span class="p">,</span>
                  <span class="n">source_dimension_order</span><span class="p">:</span> <span class="n">DimensionOrder</span> <span class="o">=</span> <span class="n">DimensionOrder</span><span class="o">.</span><span class="n">BSC</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Utility function for loading an inverse camera response function from a .txt file. Expects a 2D NumPy array</span>
<span class="sd">    with shape (N, C), with N representing the number of datapoints</span>
<span class="sd">    Args:</span>
<span class="sd">        path: path to the text file containing the ICRF data.</span>
<span class="sd">        source_channel_order: the order in which the channels are expected to be in the file.</span>
<span class="sd">        source_dimension_order: the order in which the dimensions are expected to be in the file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        torch.Tensor representing the ICRF.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="n">validate_input_file_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.txt&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">path</span><span class="p">))</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>  <span class="c1"># shape: (256, 3), BGR order</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Failed to load NumPy array from </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">source_dimension_order</span> <span class="o">==</span> <span class="n">DimensionOrder</span><span class="o">.</span><span class="n">BCS</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">elif</span> <span class="n">source_dimension_order</span> <span class="o">==</span> <span class="n">DimensionOrder</span><span class="o">.</span><span class="n">BSC</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># No change for any and RGB ordering.</span>
    <span class="k">if</span> <span class="n">source_channel_order</span> <span class="o">==</span> <span class="n">ChannelOrder</span><span class="o">.</span><span class="n">ANY</span> <span class="ow">or</span> <span class="n">source_channel_order</span> <span class="o">==</span> <span class="n">ChannelOrder</span><span class="o">.</span><span class="n">RGB</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="c1"># Reverse BGR order into RGB order.</span>
    <span class="k">elif</span> <span class="n">source_channel_order</span> <span class="o">==</span> <span class="n">ChannelOrder</span><span class="o">.</span><span class="n">BGR</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">:]</span>
    <span class="c1"># Raise value error for unknown channel ordering.</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown channel order </span><span class="si">{</span><span class="n">source_channel_order</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="clair_torch.common.load_image" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_image</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">transforms</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Generic function to load a single image from the given path. Allows also the definition of transformations to be
performed on the image before returning it upstream.
Args:
    file_path: path to the image file.
    transforms: single Transform or Iterable of Transforms to be performed on the image before returning it.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The loaded and possibly operated image in Tensor format.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/data_io.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@typechecked</span>
<span class="k">def</span><span class="w"> </span><span class="nf">load_image</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span>
               <span class="n">transforms</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BaseTransform</span> <span class="o">|</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">BaseTransform</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generic function to load a single image from the given path. Allows also the definition of transformations to be</span>
<span class="sd">    performed on the image before returning it upstream.</span>
<span class="sd">    Args:</span>
<span class="sd">        file_path: path to the image file.</span>
<span class="sd">        transforms: single Transform or Iterable of Transforms to be performed on the image before returning it.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The loaded and possibly operated image in Tensor format.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">validate_input_file_path</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="n">transforms</span> <span class="o">=</span> <span class="n">normalize_container</span><span class="p">(</span><span class="n">transforms</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">),</span> <span class="n">cv</span><span class="o">.</span><span class="n">IMREAD_UNCHANGED</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to load NumPy array from </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">image</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">cv_to_torch</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">transforms</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">transform</span> <span class="ow">in</span> <span class="n">transforms</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">transform</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">image</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="clair_torch.common.load_principal_components" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_principal_components</span><span class="p">(</span><span class="n">file_paths</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Loads principal component data from text files, one file per color channel. The files in the input paths should be
ordered in the desired channel order. E.g. for RGB images it should point to the red, green and blue files in order.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file_paths</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span> | <span title="pathlib.Path">Path</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of paths to the .txt files (one per channel).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A torch.Tensor of shape (n_points, n_components, channels).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/data_io.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@typechecked</span>
<span class="k">def</span><span class="w"> </span><span class="nf">load_principal_components</span><span class="p">(</span><span class="n">file_paths</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Loads principal component data from text files, one file per color channel. The files in the input paths should be</span>
<span class="sd">    ordered in the desired channel order. E.g. for RGB images it should point to the red, green and blue files in order.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_paths: List of paths to the .txt files (one per channel).</span>

<span class="sd">    Returns:</span>
<span class="sd">        A torch.Tensor of shape (n_points, n_components, channels).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pcs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">file_paths</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">pcs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>  <span class="c1"># Shape: (n_points, n_components)</span>

    <span class="n">pcs_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">pcs</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># Shape: (n_points, n_components, channels)</span>
    <span class="k">return</span> <span class="n">pcs_tensor</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="clair_torch.common.load_video_frames_generator" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_video_frames_generator</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">transforms</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Function for loading frames from a video file through a generator.
Args:
    file_path: path to the video file.
    transforms: optional list of transform operations to perform on each frame before yielding them.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Generator, which yields torch.Tensors.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/data_io.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@typechecked</span>
<span class="k">def</span><span class="w"> </span><span class="nf">load_video_frames_generator</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span>
                                <span class="n">transforms</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BaseTransform</span> <span class="o">|</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">BaseTransform</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> \
                                <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function for loading frames from a video file through a generator.</span>
<span class="sd">    Args:</span>
<span class="sd">        file_path: path to the video file.</span>
<span class="sd">        transforms: optional list of transform operations to perform on each frame before yielding them.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Generator, which yields torch.Tensors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">validate_input_file_path</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="n">transforms</span> <span class="o">=</span> <span class="n">normalize_container</span><span class="p">(</span><span class="n">transforms</span><span class="p">)</span>

    <span class="n">cap</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">))</span>
    <span class="n">success</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="k">while</span> <span class="n">success</span><span class="p">:</span>
        <span class="n">tensor_frame</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
        <span class="n">tensor_frame</span> <span class="o">=</span> <span class="n">cv_to_torch</span><span class="p">(</span><span class="n">tensor_frame</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">transforms</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">transform</span> <span class="ow">in</span> <span class="n">transforms</span><span class="p">:</span>
                <span class="n">tensor_frame</span> <span class="o">=</span> <span class="n">transform</span><span class="p">(</span><span class="n">tensor_frame</span><span class="p">)</span>

        <span class="k">yield</span> <span class="n">tensor_frame</span>
        <span class="n">success</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="n">cap</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="clair_torch.common.normalize_tensor" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">normalize_tensor</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">max_val</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">min_val</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target_range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Normalize a tensor by a given min and max value. If not provided, uses the min and max of the tensor.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input tensor.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_val</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional maximum value for normalization.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_val</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional minimum value for normalization.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target_range</code>
            </td>
            <td>
                  <code><span title="tuple">tuple</span>[<span title="float">float</span>, <span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple specifying the (min, max) target range.</p>
              </div>
            </td>
            <td>
                  <code>(0.0, 1.0)</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The normalized tensor.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/general_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">normalize_tensor</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">max_val</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">min_val</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                     <span class="n">target_range</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Normalize a tensor by a given min and max value. If not provided, uses the min and max of the tensor.</span>

<span class="sd">    Args:</span>
<span class="sd">        x: Input tensor.</span>
<span class="sd">        max_val: Optional maximum value for normalization.</span>
<span class="sd">        min_val: Optional minimum value for normalization.</span>
<span class="sd">        target_range: Tuple specifying the (min, max) target range.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The normalized tensor.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">max_val</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="k">if</span> <span class="n">max_val</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">max_val</span>
    <span class="n">min_val</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="k">if</span> <span class="n">min_val</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">min_val</span>

    <span class="n">denominator</span> <span class="o">=</span> <span class="n">max_val</span> <span class="o">-</span> <span class="n">min_val</span>
    <span class="k">if</span> <span class="n">denominator</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Normalization range is zero (min == max); cannot normalize.&quot;</span><span class="p">)</span>

    <span class="c1"># Normalize to [0, 1]</span>
    <span class="n">x_normalized</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">min_val</span><span class="p">)</span> <span class="o">/</span> <span class="n">denominator</span>

    <span class="c1"># Scale to [target_min, target_max]</span>
    <span class="n">min_target</span><span class="p">,</span> <span class="n">max_target</span> <span class="o">=</span> <span class="n">target_range</span>
    <span class="n">target_span</span> <span class="o">=</span> <span class="n">max_target</span> <span class="o">-</span> <span class="n">min_target</span>
    <span class="n">x_scaled</span> <span class="o">=</span> <span class="n">x_normalized</span> <span class="o">*</span> <span class="n">target_span</span> <span class="o">+</span> <span class="n">min_target</span>

    <span class="k">return</span> <span class="n">x_scaled</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="clair_torch.common.save_icrf_txt" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_icrf_txt</span><span class="p">(</span><span class="n">icrf</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">target_channel_order</span><span class="o">=</span><span class="n">ChannelOrder</span><span class="o">.</span><span class="n">BGR</span><span class="p">,</span> <span class="n">target_dimension_order</span><span class="o">=</span><span class="n">DimensionOrder</span><span class="o">.</span><span class="n">BSC</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Utility function to save an ICRF into a .txt file of the given filepath.
Args:
    icrf: the ICRF tensor.
    target_channel_order: the order in which the channels are to be in the saved data.
    target_dimension_order: the order in which the dimensions are to be in the saved data.
    path: the filepath where to save the file.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/data_io.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@typechecked</span>
<span class="k">def</span><span class="w"> </span><span class="nf">save_icrf_txt</span><span class="p">(</span><span class="n">icrf</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span> <span class="n">target_channel_order</span><span class="p">:</span> <span class="n">ChannelOrder</span> <span class="o">=</span> <span class="n">ChannelOrder</span><span class="o">.</span><span class="n">BGR</span><span class="p">,</span>
                  <span class="n">target_dimension_order</span><span class="p">:</span> <span class="n">DimensionOrder</span> <span class="o">=</span> <span class="n">DimensionOrder</span><span class="o">.</span><span class="n">BSC</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Utility function to save an ICRF into a .txt file of the given filepath.</span>
<span class="sd">    Args:</span>
<span class="sd">        icrf: the ICRF tensor.</span>
<span class="sd">        target_channel_order: the order in which the channels are to be in the saved data.</span>
<span class="sd">        target_dimension_order: the order in which the dimensions are to be in the saved data.</span>
<span class="sd">        path: the filepath where to save the file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_potentially_valid_file_path</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid path for your OS: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">icrf</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">target_channel_order</span> <span class="o">==</span> <span class="n">ChannelOrder</span><span class="o">.</span><span class="n">RGB</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">elif</span> <span class="n">target_channel_order</span> <span class="o">==</span> <span class="n">ChannelOrder</span><span class="o">.</span><span class="n">BGR</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">:]</span>

    <span class="k">if</span> <span class="n">target_dimension_order</span> <span class="o">==</span> <span class="n">DimensionOrder</span><span class="o">.</span><span class="n">BCS</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">elif</span> <span class="n">target_dimension_order</span> <span class="o">==</span> <span class="n">DimensionOrder</span><span class="o">.</span><span class="n">BSC</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Couldn&#39;t save data to path </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="clair_torch.common.save_image" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_image</span><span class="p">(</span><span class="n">tensor</span><span class="p">,</span> <span class="n">image_save_path</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float64&#39;</span><span class="p">),</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Save a PyTorch tensor as a 32-bit float per channel TIFF image.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>tensor</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A PyTorch tensor of shape (C, H, W) or (H, W), dtype float32.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>image_save_path</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to save the image.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dtype</code>
            </td>
            <td>
                  <code><span title="numpy.dtype">dtype</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the NumPy datatype to use to save the image.</p>
              </div>
            </td>
            <td>
                  <code><span title="numpy.dtype">dtype</span>(&#39;float64&#39;)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Sequence">Sequence</span>[<span title="int">int</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sequence of params to pass to OpenCV imwrite function.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/data_io.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@typechecked</span>
<span class="k">def</span><span class="w"> </span><span class="nf">save_image</span><span class="p">(</span><span class="n">tensor</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">image_save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s2">&quot;float64&quot;</span><span class="p">),</span>
               <span class="n">params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save a PyTorch tensor as a 32-bit float per channel TIFF image.</span>

<span class="sd">    Args:</span>
<span class="sd">        tensor: A PyTorch tensor of shape (C, H, W) or (H, W), dtype float32.</span>
<span class="sd">        image_save_path: Path to save the image.</span>
<span class="sd">        dtype: the NumPy datatype to use to save the image.</span>
<span class="sd">        params: Sequence of params to pass to OpenCV imwrite function.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_potentially_valid_file_path</span><span class="p">(</span><span class="n">image_save_path</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid path for your OS: </span><span class="si">{</span><span class="n">image_save_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">image_save_path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">image_save_path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Couldn&#39;t create the directory structure for path </span><span class="si">{</span><span class="n">image_save_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">tensor</span><span class="o">.</span><span class="n">is_cuda</span><span class="p">:</span>
        <span class="n">tensor</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span>

    <span class="n">array</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>

    <span class="c1"># Handle 3-channel (C, H, W) case: convert to (H, W, C) and reorder to BGR</span>
    <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>  <span class="c1"># (H, W, C)</span>
        <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span>  <span class="c1"># RGB → BGR</span>

    <span class="n">success</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">image_save_path</span><span class="p">),</span> <span class="n">array</span><span class="p">,</span> <span class="n">params</span> <span class="ow">or</span> <span class="p">[])</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to save image to </span><span class="si">{</span><span class="n">image_save_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="clair_torch.common.weighted_mean_and_std" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">weighted_mean_and_std</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-08</span><span class="p">,</span> <span class="n">compute_std</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Computes the weighted mean and variance of <code>values</code>, with optional weights and boolean mask.
Args:
    values (Tensor): Input tensor.
    weights (Tensor or None): Optional weights, broadcastable to <code>values</code>.
    mask (Tensor or None): Optional boolean mask, where True = valid value.
    dim (int or tuple of ints): Axis or axes to reduce over.
    keepdim (bool): Keep reduced dimensions.
    eps (float): Small value to avoid division by zero.
    compute_std: whether to compute std or not.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>(<span title="mean">mean</span>, <span title="variance">variance</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple of tensors, each of the reduced shape.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>clair_torch/common/general_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@typechecked</span>
<span class="k">def</span><span class="w"> </span><span class="nf">weighted_mean_and_std</span><span class="p">(</span>
        <span class="n">values</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">weights</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">mask</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eps</span><span class="p">:</span>  <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-8</span><span class="p">,</span> <span class="n">compute_std</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> \
        <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the weighted mean and variance of `values`, with optional weights and boolean mask.</span>
<span class="sd">    Args:</span>
<span class="sd">        values (Tensor): Input tensor.</span>
<span class="sd">        weights (Tensor or None): Optional weights, broadcastable to `values`.</span>
<span class="sd">        mask (Tensor or None): Optional boolean mask, where True = valid value.</span>
<span class="sd">        dim (int or tuple of ints): Axis or axes to reduce over.</span>
<span class="sd">        keepdim (bool): Keep reduced dimensions.</span>
<span class="sd">        eps (float): Small value to avoid division by zero.</span>
<span class="sd">        compute_std: whether to compute std or not.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (mean, variance): Tuple of tensors, each of the reduced shape.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">std</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

        <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">values</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">values</span> <span class="o">*</span> <span class="n">mask</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span> <span class="o">*</span> <span class="n">mask</span> <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">mask</span>

    <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

        <span class="n">mean</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="n">dim</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">compute_std</span><span class="p">:</span>
            <span class="n">sq_diff</span> <span class="o">=</span> <span class="p">(</span><span class="n">values</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="n">std</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sq_diff</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="n">dim</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="n">weighted_sum</span> <span class="o">=</span> <span class="p">(</span><span class="n">values</span> <span class="o">*</span> <span class="n">weights</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="n">dim</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">total_weight</span> <span class="o">=</span> <span class="n">weights</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="n">dim</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">eps</span><span class="p">)</span>

        <span class="c1"># Handle edge case: total weight is zero (e.g. all weights are 0 or all masked)</span>
        <span class="n">zero_weight_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">total_weight</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">safe_weight</span> <span class="o">=</span> <span class="n">total_weight</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">eps</span><span class="p">)</span>

        <span class="n">mean</span> <span class="o">=</span> <span class="n">weighted_sum</span> <span class="o">/</span> <span class="n">safe_weight</span>

        <span class="k">if</span> <span class="n">compute_std</span><span class="p">:</span>
            <span class="n">sq_diff</span> <span class="o">=</span> <span class="p">(</span><span class="n">values</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="n">weighted_sq_diff</span> <span class="o">=</span> <span class="p">(</span><span class="n">sq_diff</span> <span class="o">*</span> <span class="n">weights</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="n">dim</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">std</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">weighted_sq_diff</span> <span class="o">/</span> <span class="n">safe_weight</span><span class="p">)</span>

        <span class="c1"># Set mean and std to 0 where total weight is zero</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">zero_weight_mask</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">mean</span><span class="p">),</span> <span class="n">mean</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">compute_std</span><span class="p">:</span>
            <span class="n">std</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">zero_weight_mask</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">std</span><span class="p">),</span> <span class="n">std</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">keepdim</span><span class="p">:</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="n">mean</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span> <span class="k">if</span> <span class="n">dim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">mean</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">compute_std</span><span class="p">:</span>
            <span class="n">std</span> <span class="o">=</span> <span class="n">std</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span> <span class="k">if</span> <span class="n">dim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">std</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">mean</span><span class="p">,</span> <span class="n">std</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>