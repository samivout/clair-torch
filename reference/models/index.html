
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../metadata/">
      
      
        <link rel="next" href="../summary/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.20">
    
    
      
        <title>Models - camera-linearity-torch docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.e53b48f4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#models" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="camera-linearity-torch docs" class="md-header__button md-logo" aria-label="camera-linearity-torch docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            camera-linearity-torch docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Models
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="camera-linearity-torch docs" class="md-nav__button md-logo" aria-label="camera-linearity-torch docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    camera-linearity-torch docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Welcome to clair-torch
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Explanation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../common/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Common
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../datasets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Datasets
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../inference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Inference
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../metadata/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Metadata
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Models
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Models
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#clair_torch.models" class="md-nav__link">
    <span class="md-ellipsis">
      models
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.models.ICRFModelBase" class="md-nav__link">
    <span class="md-ellipsis">
      ICRFModelBase
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ICRFModelBase">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clair_torch.models.ICRFModelBase--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.models.ICRFModelBase.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.models.ICRFModelBase.channel_params" class="md-nav__link">
    <span class="md-ellipsis">
      channel_params
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.models.ICRFModelBase.plot_icrf" class="md-nav__link">
    <span class="md-ellipsis">
      plot_icrf
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.models.ICRFModelBase.update_icrf" class="md-nav__link">
    <span class="md-ellipsis">
      update_icrf
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.models.ICRFModelDirect" class="md-nav__link">
    <span class="md-ellipsis">
      ICRFModelDirect
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ICRFModelDirect">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clair_torch.models.ICRFModelDirect--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.models.ICRFModelDirect.channel_params" class="md-nav__link">
    <span class="md-ellipsis">
      channel_params
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.models.ICRFModelDirect.update_icrf" class="md-nav__link">
    <span class="md-ellipsis">
      update_icrf
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.models.ICRFModelPCA" class="md-nav__link">
    <span class="md-ellipsis">
      ICRFModelPCA
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ICRFModelPCA">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clair_torch.models.ICRFModelPCA--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.models.ICRFModelPCA.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.models.ICRFModelPCA.channel_params" class="md-nav__link">
    <span class="md-ellipsis">
      channel_params
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.models.ICRFModelPCA.update_icrf" class="md-nav__link">
    <span class="md-ellipsis">
      update_icrf
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../summary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Summary
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../training/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Training
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../validation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Validation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../visualization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Visualization
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#clair_torch.models" class="md-nav__link">
    <span class="md-ellipsis">
      models
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.models.ICRFModelBase" class="md-nav__link">
    <span class="md-ellipsis">
      ICRFModelBase
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ICRFModelBase">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clair_torch.models.ICRFModelBase--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.models.ICRFModelBase.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.models.ICRFModelBase.channel_params" class="md-nav__link">
    <span class="md-ellipsis">
      channel_params
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.models.ICRFModelBase.plot_icrf" class="md-nav__link">
    <span class="md-ellipsis">
      plot_icrf
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.models.ICRFModelBase.update_icrf" class="md-nav__link">
    <span class="md-ellipsis">
      update_icrf
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.models.ICRFModelDirect" class="md-nav__link">
    <span class="md-ellipsis">
      ICRFModelDirect
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ICRFModelDirect">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clair_torch.models.ICRFModelDirect--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.models.ICRFModelDirect.channel_params" class="md-nav__link">
    <span class="md-ellipsis">
      channel_params
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.models.ICRFModelDirect.update_icrf" class="md-nav__link">
    <span class="md-ellipsis">
      update_icrf
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clair_torch.models.ICRFModelPCA" class="md-nav__link">
    <span class="md-ellipsis">
      ICRFModelPCA
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ICRFModelPCA">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clair_torch.models.ICRFModelPCA--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.models.ICRFModelPCA.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.models.ICRFModelPCA.channel_params" class="md-nav__link">
    <span class="md-ellipsis">
      channel_params
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clair_torch.models.ICRFModelPCA.update_icrf" class="md-nav__link">
    <span class="md-ellipsis">
      update_icrf
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="models">Models</h1>
<p>This page acts as the technical reference for the models subpackage.</p>


<div class="doc doc-object doc-module">



<a id="clair_torch.models"></a>
    <div class="doc doc-contents first">

        <p>The models package provides the inverse camera response function model classes, which are built on the torch.nn.module
class. The base model provides a guideline for creating a new ICRF model, while the concrete implementations provide
different approaches to modelling an ICRF.</p>










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="clair_torch.models.ICRFModelBase" class="doc doc-heading">
            <code>ICRFModelBase</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code>, <code><span title="abc.ABC">ABC</span></code></p>


        <p>Base class for the ICRF model classes. Implements common functionality and acts as a guideline for implementing the
model interface.</p>
<h4 id="clair_torch.models.ICRFModelBase--attributes">Attributes</h4>
<p>_n_points: int
    how many datapoints the range [0, 1] is split into in modelling the ICRF.
_channels: int
    how many color channels are managed by the model. One ICRF curve for each channel.
interpolation_mode: InterpMode
    enum determining how the forward call of the model is handled. See InterpMode doc for more.
_initial_power: float
    a guess at the initial form of the ICRF curve, represented by raising the linear range [0, 1] to this power.
_fig: Figure
    a matplotlib Figure used for visualizing the model.
_axs: List[Axes]
    a list of matplotlib axes used for model visualization.
_lines_curve: List[Line2D]
    a list of the matplotlib Line2D objects for the plotted curves used in model visualization.
_lines_deriv: List[Line2D]
    a list of the matplotlib Line2D objects for the plotted curves' derivatives used in model visualization.</p>








              <details class="quote">
                <summary>Source code in <code>clair_torch/models/base.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ICRFModelBase</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for the ICRF model classes. Implements common functionality and acts as a guideline for implementing the</span>
<span class="sd">    model interface.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    _n_points: int</span>
<span class="sd">        how many datapoints the range [0, 1] is split into in modelling the ICRF.</span>
<span class="sd">    _channels: int</span>
<span class="sd">        how many color channels are managed by the model. One ICRF curve for each channel.</span>
<span class="sd">    interpolation_mode: InterpMode</span>
<span class="sd">        enum determining how the forward call of the model is handled. See InterpMode doc for more.</span>
<span class="sd">    _initial_power: float</span>
<span class="sd">        a guess at the initial form of the ICRF curve, represented by raising the linear range [0, 1] to this power.</span>
<span class="sd">    _fig: Figure</span>
<span class="sd">        a matplotlib Figure used for visualizing the model.</span>
<span class="sd">    _axs: List[Axes]</span>
<span class="sd">        a list of matplotlib axes used for model visualization.</span>
<span class="sd">    _lines_curve: List[Line2D]</span>
<span class="sd">        a list of the matplotlib Line2D objects for the plotted curves used in model visualization.</span>
<span class="sd">    _lines_deriv: List[Line2D]</span>
<span class="sd">        a list of the matplotlib Line2D objects for the plotted curves&#39; derivatives used in model visualization.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@typechecked</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_points</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">256</span><span class="p">,</span> <span class="n">channels</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
                 <span class="n">interpolation_mode</span><span class="p">:</span> <span class="n">InterpMode</span> <span class="o">=</span> <span class="n">InterpMode</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">,</span> <span class="n">initial_power</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.5</span><span class="p">,</span>
                 <span class="n">icrf</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the ICRF model instance with the given parameters. The icrf argument overrides n_points and channels</span>
<span class="sd">        by its shape if given.</span>
<span class="sd">        Args:</span>
<span class="sd">            n_points: how many datapoints the range [0, 1] is split into in modelling the ICRF.</span>
<span class="sd">            channels: how many datapoints the range [0, 1] is split into in modelling the ICRF.</span>
<span class="sd">            interpolation_mode: enum determining how the forward call of the model is handled. See InterpMode doc for</span>
<span class="sd">                more.</span>
<span class="sd">            initial_power: a guess at the initial form of the ICRF curve, represented by raising the linear range [0, 1]</span>
<span class="sd">                to this power.</span>
<span class="sd">            icrf: an optional initial form of the ICRF curves, overrides n_points and channels.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1"># If an ICRF curve is given, its shape will override the given n_points and channels parameters.</span>
        <span class="k">if</span> <span class="n">icrf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">channels</span><span class="p">,</span> <span class="n">n_points</span> <span class="o">=</span> <span class="n">icrf</span><span class="o">.</span><span class="n">shape</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_channels</span> <span class="o">=</span> <span class="n">channels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initial_power</span> <span class="o">=</span> <span class="n">initial_power</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_n_points</span> <span class="o">=</span> <span class="n">n_points</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_buffer</span><span class="p">(</span><span class="s2">&quot;_x_axis_datapoints&quot;</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_points</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">icrf</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">icrf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_default_icrf</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_buffer</span><span class="p">(</span><span class="s2">&quot;_icrf&quot;</span><span class="p">,</span> <span class="n">icrf</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">interpolation_mode</span> <span class="o">=</span> <span class="n">interpolation_mode</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_dispatch</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">InterpMode</span><span class="o">.</span><span class="n">LOOKUP</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forward_lookup</span><span class="p">,</span>
            <span class="n">InterpMode</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forward_linear</span><span class="p">,</span>
            <span class="n">InterpMode</span><span class="o">.</span><span class="n">CATMULL</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forward_catmull</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">interpolation_mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dispatch</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Unknown interpolation mode </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">interpolation_mode</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_fig</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_axs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lines_curve</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lines_deriv</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">icrf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_icrf</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">channels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_channels</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">n_points</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_points</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">initial_power</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initial_power</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">x_axis_datapoints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_axis_datapoints</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">channel_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method for getting the model parameters for the channel of the given index. Subclasses implement the logic</span>
<span class="sd">        based on their model parameters. This should be the main method of accessing the optimization parameters for</span>
<span class="sd">        feeding them to a torch.Optimizer.</span>
<span class="sd">        Args:</span>
<span class="sd">            c: channel index.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list of nn.Parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_icrf</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method for constructing a new ICRF curve from the model parameters and updating the curve to the</span>
<span class="sd">        self._icrf attribute. Subclasses implement the logic based their model parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_initialize_default_icrf</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes a default ICRF curve if None is given, based on the number of datapoints, channels and the value</span>
<span class="sd">        of the initial power.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_points</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">)</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_power</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dispatch</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">interpolation_mode</span><span class="p">](</span><span class="n">image</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_forward_lookup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Nearest-neighbour table lookup (no gradients).</span>
<span class="sd">        image: (N, C, H, W) with values in [0, 1]</span>
<span class="sd">        self.icrf: (L, C) first dim = curve sample, second dim = channel</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">N</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">W</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">icrf</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># integer sample index per pixel</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">image</span> <span class="o">*</span> <span class="p">(</span><span class="n">L</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">round</span><span class="p">()</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">long</span><span class="p">()</span>  <span class="c1"># (N, C, H, W)</span>

        <span class="c1"># matching channel index tensor</span>
        <span class="n">chan</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">image</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
            <span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">W</span><span class="p">)</span>  <span class="c1"># same shape as idx</span>
        <span class="p">)</span>

        <span class="c1"># advanced indexing: returns (N, C, H, W)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">icrf</span><span class="p">[</span><span class="n">chan</span><span class="p">,</span> <span class="n">idx</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_forward_linear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
        <span class="c1"># image : (N, C, H, W) in [0, 1]</span>
        <span class="n">N</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">W</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">icrf</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># scale pixel values to LUT index range [0, L-1]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">image</span> <span class="o">*</span> <span class="p">(</span><span class="n">L</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">clamp_</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">x0</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">floor</span><span class="p">()</span><span class="o">.</span><span class="n">long</span><span class="p">()</span>  <span class="c1"># lower index</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">clamp_</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># upper index</span>
        <span class="n">w</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x0</span><span class="o">.</span><span class="n">float</span><span class="p">())</span>  <span class="c1"># weight  (N,C,H,W)</span>

        <span class="c1"># helper that gathers LUT values for arbitrary index tensor</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">gather</span><span class="p">(</span><span class="n">ix</span><span class="p">):</span>
            <span class="n">flat_ix</span> <span class="o">=</span> <span class="n">ix</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># safe flatten</span>
            <span class="n">channels</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">ix</span><span class="o">.</span><span class="n">device</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">N</span> <span class="o">*</span> <span class="n">H</span> <span class="o">*</span> <span class="n">W</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">icrf</span><span class="p">[</span><span class="n">channels</span><span class="p">,</span> <span class="n">flat_ix</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">W</span><span class="p">)</span>  <span class="c1"># safe reshape</span>

        <span class="n">g0</span> <span class="o">=</span> <span class="n">gather</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="n">gather</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span>

        <span class="c1"># linear interpolation</span>
        <span class="k">return</span> <span class="n">g0</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">w</span><span class="p">)</span> <span class="o">+</span> <span class="n">g1</span> <span class="o">*</span> <span class="n">w</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_forward_catmull</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
        <span class="c1"># Assume image shape: (N, C, H, W), values in [0, 1]</span>
        <span class="n">N</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">W</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">icrf</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># number of ICRF samples</span>

        <span class="c1"># Scale input to [0, L - 1]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">image</span> <span class="o">*</span> <span class="p">(</span><span class="n">L</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Compute indices for Catmull-Rom interpolation</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">floor</span><span class="p">()</span><span class="o">.</span><span class="n">long</span><span class="p">()</span>
        <span class="n">x_indices</span> <span class="o">=</span> <span class="p">[</span>  <span class="c1"># Collect 4 neighboring indices: x-1, x0, x0+1, x0+2</span>
            <span class="p">(</span><span class="n">x0</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">x0</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span>
        <span class="p">]</span>

        <span class="c1"># Compute fractional part</span>
        <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x0</span><span class="o">.</span><span class="n">float</span><span class="p">())</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Catmull-Rom basis weights</span>
        <span class="n">t2</span> <span class="o">=</span> <span class="n">t</span> <span class="o">*</span> <span class="n">t</span>
        <span class="n">t3</span> <span class="o">=</span> <span class="n">t2</span> <span class="o">*</span> <span class="n">t</span>

        <span class="n">w0</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">t3</span> <span class="o">+</span> <span class="n">t2</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">t</span>
        <span class="n">w1</span> <span class="o">=</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">t3</span> <span class="o">-</span> <span class="mf">2.5</span> <span class="o">*</span> <span class="n">t2</span> <span class="o">+</span> <span class="mf">1.0</span>
        <span class="n">w2</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.5</span> <span class="o">*</span> <span class="n">t3</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">t2</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">t</span>
        <span class="n">w3</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">t3</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">t2</span>

        <span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="n">w0</span><span class="p">,</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">,</span> <span class="n">w3</span><span class="p">]</span>  <span class="c1"># each (N, C, H, W)</span>

        <span class="c1"># Broadcast gather: returns (N, C, H, W) for each index tensor</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">gather_idx</span><span class="p">(</span><span class="n">ix</span><span class="p">):</span>
            <span class="n">flat_idx</span> <span class="o">=</span> <span class="n">ix</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">channels</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">C</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">N</span> <span class="o">*</span> <span class="n">H</span> <span class="o">*</span> <span class="n">W</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">icrf</span><span class="p">[</span><span class="n">channels</span><span class="p">,</span> <span class="n">flat_idx</span><span class="p">]</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">W</span><span class="p">)</span>

        <span class="n">g</span> <span class="o">=</span> <span class="p">[</span><span class="n">gather_idx</span><span class="p">(</span><span class="n">ix</span><span class="p">)</span> <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="n">x_indices</span><span class="p">]</span>

        <span class="c1"># Final smooth interpolated result</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">w</span> <span class="o">*</span> <span class="n">gi</span> <span class="k">for</span> <span class="n">w</span><span class="p">,</span> <span class="n">gi</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">g</span><span class="p">)],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_prepare_icrf_plot_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Internal utility function to prepare the model data for plotting.</span>
<span class="sd">        Returns:</span>
<span class="sd">            Tuple of NumPy arrays representing [x_values, y_values, dy/dx_values].</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">icrf_cpu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">icrf</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_points</span><span class="p">)</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">icrf_cpu</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dydx</span> <span class="o">=</span> <span class="n">dy</span> <span class="o">/</span> <span class="n">dx</span>

        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">icrf_cpu</span><span class="p">,</span> <span class="n">dydx</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">plot_icrf</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Model utility function for live-plotting. The model class manages the state of the plot, while utilizing the</span>
<span class="sd">        general plotting function of the plotting module.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">icrf_cpu</span><span class="p">,</span> <span class="n">dydx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_icrf_plot_data</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>  <span class="c1"># Enable interactive mode for live plotting.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fig</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_axs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lines_curve</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lines_deriv</span> <span class="o">=</span> <span class="n">plot_data_and_diff</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">icrf_cpu</span><span class="p">,</span> <span class="n">dydx</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_lines_curve</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">set_ydata</span><span class="p">(</span><span class="n">icrf_cpu</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="p">:])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_lines_deriv</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">set_ydata</span><span class="p">(</span><span class="n">dydx</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="p">:])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">flush_events</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">pause</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="clair_torch.models.ICRFModelBase.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">n_points</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">channels</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">interpolation_mode</span><span class="o">=</span><span class="n">InterpMode</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">,</span> <span class="n">initial_power</span><span class="o">=</span><span class="mf">2.5</span><span class="p">,</span> <span class="n">icrf</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initializes the ICRF model instance with the given parameters. The icrf argument overrides n_points and channels
by its shape if given.
Args:
    n_points: how many datapoints the range [0, 1] is split into in modelling the ICRF.
    channels: how many datapoints the range [0, 1] is split into in modelling the ICRF.
    interpolation_mode: enum determining how the forward call of the model is handled. See InterpMode doc for
        more.
    initial_power: a guess at the initial form of the ICRF curve, represented by raising the linear range [0, 1]
        to this power.
    icrf: an optional initial form of the ICRF curves, overrides n_points and channels.</p>


            <details class="quote">
              <summary>Source code in <code>clair_torch/models/base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@typechecked</span>
<span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_points</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">256</span><span class="p">,</span> <span class="n">channels</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
             <span class="n">interpolation_mode</span><span class="p">:</span> <span class="n">InterpMode</span> <span class="o">=</span> <span class="n">InterpMode</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">,</span> <span class="n">initial_power</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.5</span><span class="p">,</span>
             <span class="n">icrf</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initializes the ICRF model instance with the given parameters. The icrf argument overrides n_points and channels</span>
<span class="sd">    by its shape if given.</span>
<span class="sd">    Args:</span>
<span class="sd">        n_points: how many datapoints the range [0, 1] is split into in modelling the ICRF.</span>
<span class="sd">        channels: how many datapoints the range [0, 1] is split into in modelling the ICRF.</span>
<span class="sd">        interpolation_mode: enum determining how the forward call of the model is handled. See InterpMode doc for</span>
<span class="sd">            more.</span>
<span class="sd">        initial_power: a guess at the initial form of the ICRF curve, represented by raising the linear range [0, 1]</span>
<span class="sd">            to this power.</span>
<span class="sd">        icrf: an optional initial form of the ICRF curves, overrides n_points and channels.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

    <span class="c1"># If an ICRF curve is given, its shape will override the given n_points and channels parameters.</span>
    <span class="k">if</span> <span class="n">icrf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">channels</span><span class="p">,</span> <span class="n">n_points</span> <span class="o">=</span> <span class="n">icrf</span><span class="o">.</span><span class="n">shape</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_channels</span> <span class="o">=</span> <span class="n">channels</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_initial_power</span> <span class="o">=</span> <span class="n">initial_power</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_n_points</span> <span class="o">=</span> <span class="n">n_points</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">register_buffer</span><span class="p">(</span><span class="s2">&quot;_x_axis_datapoints&quot;</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_points</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">icrf</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">icrf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_default_icrf</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">register_buffer</span><span class="p">(</span><span class="s2">&quot;_icrf&quot;</span><span class="p">,</span> <span class="n">icrf</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">interpolation_mode</span> <span class="o">=</span> <span class="n">interpolation_mode</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_dispatch</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">InterpMode</span><span class="o">.</span><span class="n">LOOKUP</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forward_lookup</span><span class="p">,</span>
        <span class="n">InterpMode</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forward_linear</span><span class="p">,</span>
        <span class="n">InterpMode</span><span class="o">.</span><span class="n">CATMULL</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forward_catmull</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">interpolation_mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dispatch</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Unknown interpolation mode </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">interpolation_mode</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_fig</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_axs</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_lines_curve</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_lines_deriv</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="clair_torch.models.ICRFModelBase.channel_params" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">channel_params</span><span class="p">(</span><span class="n">c</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Method for getting the model parameters for the channel of the given index. Subclasses implement the logic
based on their model parameters. This should be the main method of accessing the optimization parameters for
feeding them to a torch.Optimizer.
Args:
    c: channel index.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="torch.nn.Parameter">Parameter</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of nn.Parameters.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>clair_torch/models/base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">channel_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method for getting the model parameters for the channel of the given index. Subclasses implement the logic</span>
<span class="sd">    based on their model parameters. This should be the main method of accessing the optimization parameters for</span>
<span class="sd">    feeding them to a torch.Optimizer.</span>
<span class="sd">    Args:</span>
<span class="sd">        c: channel index.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list of nn.Parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="clair_torch.models.ICRFModelBase.plot_icrf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_icrf</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Model utility function for live-plotting. The model class manages the state of the plot, while utilizing the
general plotting function of the plotting module.</p>


            <details class="quote">
              <summary>Source code in <code>clair_torch/models/base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">plot_icrf</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model utility function for live-plotting. The model class manages the state of the plot, while utilizing the</span>
<span class="sd">    general plotting function of the plotting module.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">icrf_cpu</span><span class="p">,</span> <span class="n">dydx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_icrf_plot_data</span><span class="p">()</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>  <span class="c1"># Enable interactive mode for live plotting.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fig</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_axs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lines_curve</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lines_deriv</span> <span class="o">=</span> <span class="n">plot_data_and_diff</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">icrf_cpu</span><span class="p">,</span> <span class="n">dydx</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lines_curve</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">set_ydata</span><span class="p">(</span><span class="n">icrf_cpu</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="p">:])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lines_deriv</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">set_ydata</span><span class="p">(</span><span class="n">dydx</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="p">:])</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">flush_events</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">pause</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="clair_torch.models.ICRFModelBase.update_icrf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_icrf</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Method for constructing a new ICRF curve from the model parameters and updating the curve to the
self._icrf attribute. Subclasses implement the logic based their model parameters.</p>


            <details class="quote">
              <summary>Source code in <code>clair_torch/models/base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">update_icrf</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method for constructing a new ICRF curve from the model parameters and updating the curve to the</span>
<span class="sd">    self._icrf attribute. Subclasses implement the logic based their model parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="clair_torch.models.ICRFModelDirect" class="doc doc-heading">
            <code>ICRFModelDirect</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ICRFModelBase (clair_torch.models.base.ICRFModelBase)" href="#clair_torch.models.ICRFModelBase">ICRFModelBase</a></code></p>


        <p>An ICRF model class that utilizes the datapoints directly as optimization parameters. Total number of parameters is
therefore n_points * channels.</p>
<h4 id="clair_torch.models.ICRFModelDirect--attributes">Attributes:</h4>
<p>Inherits attributes from ICRFModelBase.</p>


<details class="direct_params" open>
  <summary>nn.ParameterList</summary>
  <p>a list of nn parameters, each parameter corresponds to an actual datapoint in the ICRF curve.</p>
</details>







              <details class="quote">
                <summary>Source code in <code>clair_torch/models/icrf_model.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ICRFModelDirect</span><span class="p">(</span><span class="n">ICRFModelBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An ICRF model class that utilizes the datapoints directly as optimization parameters. Total number of parameters is</span>
<span class="sd">    therefore n_points * channels.</span>

<span class="sd">    Attributes:</span>
<span class="sd">    ----------</span>
<span class="sd">    Inherits attributes from ICRFModelBase.</span>

<span class="sd">    direct_params: nn.ParameterList</span>
<span class="sd">        a list of nn parameters, each parameter corresponds to an actual datapoint in the ICRF curve.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@typechecked</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_points</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">256</span><span class="p">,</span> <span class="n">channels</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
                 <span class="n">interpolation_mode</span><span class="p">:</span> <span class="n">InterpMode</span> <span class="o">=</span> <span class="n">InterpMode</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">,</span> <span class="n">initial_power</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.5</span><span class="p">,</span>
                 <span class="n">icrf</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">n_points</span><span class="p">,</span> <span class="n">channels</span><span class="p">,</span> <span class="n">interpolation_mode</span><span class="p">,</span> <span class="n">initial_power</span><span class="p">,</span> <span class="n">icrf</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">direct_params</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ParameterList</span><span class="p">([</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_points</span><span class="p">)</span> <span class="o">**</span> <span class="n">initial_power</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span>
        <span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">channel_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Main method for accessing the optimization parameters of the model.</span>
<span class="sd">        Args:</span>
<span class="sd">            c: channel index.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of nn.Parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">direct_params</span><span class="p">[</span><span class="n">c</span><span class="p">]]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_icrf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Directly stack the per-channel parameters to form the ICRF.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_icrf</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">direct_params</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># shape: (L, C)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="clair_torch.models.ICRFModelDirect.channel_params" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">channel_params</span><span class="p">(</span><span class="n">c</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Main method for accessing the optimization parameters of the model.
Args:
    c: channel index.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of nn.Parameters.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>clair_torch/models/icrf_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">channel_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main method for accessing the optimization parameters of the model.</span>
<span class="sd">    Args:</span>
<span class="sd">        c: channel index.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A list of nn.Parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">direct_params</span><span class="p">[</span><span class="n">c</span><span class="p">]]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="clair_torch.models.ICRFModelDirect.update_icrf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_icrf</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Directly stack the per-channel parameters to form the ICRF.</p>


            <details class="quote">
              <summary>Source code in <code>clair_torch/models/icrf_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">update_icrf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Directly stack the per-channel parameters to form the ICRF.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_icrf</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">direct_params</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># shape: (L, C)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="clair_torch.models.ICRFModelPCA" class="doc doc-heading">
            <code>ICRFModelPCA</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ICRFModelBase (clair_torch.models.base.ICRFModelBase)" href="#clair_torch.models.ICRFModelBase">ICRFModelBase</a></code></p>


        <p>ICRF model class that utilizes a set of principal components for the optimization process. For each principal
component a single scalar optimization parameter is utilized, e.g. for 5 components there is a total of 5 parameters
to optimize in the model. The shape of the given principal components is used to determine the number of datapoints,
number of components and number of channels. In addition to these an exponent for the linear range [0, 1] is used
as a parameter for each channel.</p>
<h4 id="clair_torch.models.ICRFModelPCA--attributes">Attributes:</h4>
<p>Inherits attributes from ICRFModelBase</p>


<details class="p" open>
  <summary>nn.ParameterList</summary>
  <p>a list of nn parameters representing the exponent of the base curve. One element for each channel.</p>
</details>        <p>coefficients: nn.ParameterList
    a list of nn parameters representing the PCA parameters, for each channel a number equal to the number of
        components.</p>








              <details class="quote">
                <summary>Source code in <code>clair_torch/models/icrf_model.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ICRFModelPCA</span><span class="p">(</span><span class="n">ICRFModelBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ICRF model class that utilizes a set of principal components for the optimization process. For each principal</span>
<span class="sd">    component a single scalar optimization parameter is utilized, e.g. for 5 components there is a total of 5 parameters</span>
<span class="sd">    to optimize in the model. The shape of the given principal components is used to determine the number of datapoints,</span>
<span class="sd">    number of components and number of channels. In addition to these an exponent for the linear range [0, 1] is used</span>
<span class="sd">    as a parameter for each channel.</span>

<span class="sd">    Attributes:</span>
<span class="sd">    -----------</span>
<span class="sd">    Inherits attributes from ICRFModelBase</span>

<span class="sd">    p: nn.ParameterList</span>
<span class="sd">        a list of nn parameters representing the exponent of the base curve. One element for each channel.</span>
<span class="sd">    coefficients: nn.ParameterList</span>
<span class="sd">        a list of nn parameters representing the PCA parameters, for each channel a number equal to the number of</span>
<span class="sd">            components.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@typechecked</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pca_basis</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">interpolation_mode</span><span class="p">:</span> <span class="n">InterpMode</span> <span class="o">=</span> <span class="n">InterpMode</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">,</span>
                 <span class="n">initial_power</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.5</span><span class="p">,</span> <span class="n">icrf</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes a ICRFModelPCA instance. The pca_basis is used to determine the shape of the actual ICRF.</span>
<span class="sd">        Args:</span>
<span class="sd">            pca_basis: a torch.Tensor representing the principal components. The shape is expected to be</span>
<span class="sd">                (n_points, num_components, channels).</span>
<span class="sd">            interpolation_mode: a InterpMode determining how the ICRF is used in a forward call.</span>
<span class="sd">            initial_power: a guess at the initial form of the ICRF curve, represented by raising the linear range [0, 1]</span>
<span class="sd">                to this power.</span>
<span class="sd">            icrf: an optional initial form of the ICRF curves, overrides n_points and channels.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">n_points</span><span class="p">,</span> <span class="n">num_components</span><span class="p">,</span> <span class="n">channels</span> <span class="o">=</span> <span class="n">pca_basis</span><span class="o">.</span><span class="n">shape</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">n_points</span><span class="p">,</span> <span class="n">channels</span><span class="p">,</span> <span class="n">interpolation_mode</span><span class="p">,</span> <span class="n">initial_power</span><span class="p">,</span> <span class="n">icrf</span><span class="p">)</span>

        <span class="c1"># Base curve power (learnable scalar), one parameter per channel.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ParameterList</span><span class="p">([</span><span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="mf">2.0</span><span class="p">))</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">channels</span><span class="p">)])</span>

        <span class="c1"># Model weights, num_components number per channel.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coefficients</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ParameterList</span><span class="p">([</span><span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_components</span><span class="p">))</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">channels</span><span class="p">)])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">register_buffer</span><span class="p">(</span><span class="s2">&quot;pca_basis&quot;</span><span class="p">,</span> <span class="n">pca_basis</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_buffer</span><span class="p">(</span><span class="s2">&quot;x_values&quot;</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_points</span><span class="p">))</span>  <span class="c1"># (L,)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">channel_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Main method for accessing the optimization parameters of the model.</span>
<span class="sd">        Args:</span>
<span class="sd">            c: channel index.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of nn.Parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">c</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">coefficients</span><span class="p">[</span><span class="n">c</span><span class="p">]]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_icrf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Builds the full ICRF curve (n_points, channels) from base + PCA.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">))</span>
        <span class="n">coefficient_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coefficients</span><span class="p">))</span>

        <span class="c1"># x_values: (L,)</span>
        <span class="n">x_safe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_values</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># (L, 1)</span>

        <span class="c1"># Compute per-channel base curve: (L, C)</span>
        <span class="n">base_curve</span> <span class="o">=</span> <span class="n">x_safe</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">p_tensor</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>  <span class="c1"># broadcasted over L</span>

        <span class="c1"># PCA component contribution: (L, C)</span>
        <span class="n">pca_curve</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pca_basis</span> <span class="o">*</span> <span class="n">coefficient_tensor</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Combine base and PCA to update self.icrf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_icrf</span> <span class="o">=</span> <span class="n">base_curve</span> <span class="o">+</span> <span class="n">pca_curve</span>  <span class="c1"># shape: (L, C)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="clair_torch.models.ICRFModelPCA.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">pca_basis</span><span class="p">,</span> <span class="n">interpolation_mode</span><span class="o">=</span><span class="n">InterpMode</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">,</span> <span class="n">initial_power</span><span class="o">=</span><span class="mf">2.5</span><span class="p">,</span> <span class="n">icrf</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initializes a ICRFModelPCA instance. The pca_basis is used to determine the shape of the actual ICRF.
Args:
    pca_basis: a torch.Tensor representing the principal components. The shape is expected to be
        (n_points, num_components, channels).
    interpolation_mode: a InterpMode determining how the ICRF is used in a forward call.
    initial_power: a guess at the initial form of the ICRF curve, represented by raising the linear range [0, 1]
        to this power.
    icrf: an optional initial form of the ICRF curves, overrides n_points and channels.</p>


            <details class="quote">
              <summary>Source code in <code>clair_torch/models/icrf_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@typechecked</span>
<span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pca_basis</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">interpolation_mode</span><span class="p">:</span> <span class="n">InterpMode</span> <span class="o">=</span> <span class="n">InterpMode</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">,</span>
             <span class="n">initial_power</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.5</span><span class="p">,</span> <span class="n">icrf</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initializes a ICRFModelPCA instance. The pca_basis is used to determine the shape of the actual ICRF.</span>
<span class="sd">    Args:</span>
<span class="sd">        pca_basis: a torch.Tensor representing the principal components. The shape is expected to be</span>
<span class="sd">            (n_points, num_components, channels).</span>
<span class="sd">        interpolation_mode: a InterpMode determining how the ICRF is used in a forward call.</span>
<span class="sd">        initial_power: a guess at the initial form of the ICRF curve, represented by raising the linear range [0, 1]</span>
<span class="sd">            to this power.</span>
<span class="sd">        icrf: an optional initial form of the ICRF curves, overrides n_points and channels.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n_points</span><span class="p">,</span> <span class="n">num_components</span><span class="p">,</span> <span class="n">channels</span> <span class="o">=</span> <span class="n">pca_basis</span><span class="o">.</span><span class="n">shape</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">n_points</span><span class="p">,</span> <span class="n">channels</span><span class="p">,</span> <span class="n">interpolation_mode</span><span class="p">,</span> <span class="n">initial_power</span><span class="p">,</span> <span class="n">icrf</span><span class="p">)</span>

    <span class="c1"># Base curve power (learnable scalar), one parameter per channel.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ParameterList</span><span class="p">([</span><span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="mf">2.0</span><span class="p">))</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">channels</span><span class="p">)])</span>

    <span class="c1"># Model weights, num_components number per channel.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">coefficients</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ParameterList</span><span class="p">([</span><span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_components</span><span class="p">))</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">channels</span><span class="p">)])</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">register_buffer</span><span class="p">(</span><span class="s2">&quot;pca_basis&quot;</span><span class="p">,</span> <span class="n">pca_basis</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">register_buffer</span><span class="p">(</span><span class="s2">&quot;x_values&quot;</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_points</span><span class="p">))</span>  <span class="c1"># (L,)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="clair_torch.models.ICRFModelPCA.channel_params" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">channel_params</span><span class="p">(</span><span class="n">c</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Main method for accessing the optimization parameters of the model.
Args:
    c: channel index.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="torch.nn.Parameter">Parameter</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of nn.Parameters.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>clair_torch/models/icrf_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">channel_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main method for accessing the optimization parameters of the model.</span>
<span class="sd">    Args:</span>
<span class="sd">        c: channel index.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A list of nn.Parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">c</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">coefficients</span><span class="p">[</span><span class="n">c</span><span class="p">]]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="clair_torch.models.ICRFModelPCA.update_icrf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_icrf</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Builds the full ICRF curve (n_points, channels) from base + PCA.</p>


            <details class="quote">
              <summary>Source code in <code>clair_torch/models/icrf_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">update_icrf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Builds the full ICRF curve (n_points, channels) from base + PCA.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">p_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">))</span>
    <span class="n">coefficient_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coefficients</span><span class="p">))</span>

    <span class="c1"># x_values: (L,)</span>
    <span class="n">x_safe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_values</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># (L, 1)</span>

    <span class="c1"># Compute per-channel base curve: (L, C)</span>
    <span class="n">base_curve</span> <span class="o">=</span> <span class="n">x_safe</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">p_tensor</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>  <span class="c1"># broadcasted over L</span>

    <span class="c1"># PCA component contribution: (L, C)</span>
    <span class="n">pca_curve</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pca_basis</span> <span class="o">*</span> <span class="n">coefficient_tensor</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Combine base and PCA to update self.icrf</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_icrf</span> <span class="o">=</span> <span class="n">base_curve</span> <span class="o">+</span> <span class="n">pca_curve</span>  <span class="c1"># shape: (L, C)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>